
Format: HTML
max tokens
50000

All Extensions

Base path: root
±21704 tokens


Copy
API

 Add to README

Other Tools
├── .env.example
├── .gitignore
├── Dockerfile
├── LICENSE
├── README.md
├── chat-demo-sdk
    ├── README.md
    ├── dist
    │   ├── index.d.ts
    │   └── index.js
    ├── package.json
    ├── pnpm-lock.yaml
    ├── src
    │   └── index.ts
    └── tsconfig.json
├── eslint.config.mjs
├── next-env.d.ts
├── next.config.ts
├── package-lock.json
├── package.json
├── postcss.config.mjs
├── public
    ├── file.svg
    ├── globe.svg
    ├── next.svg
    ├── vercel.svg
    └── window.svg
├── src
    └── app
    │   ├── components
    │       ├── Form.tsx
    │       ├── Header.tsx
    │       └── Welcome.tsx
    │   ├── favicon.ico
    │   ├── globals.css
    │   ├── layout.tsx
    │   ├── page.tsx
    │   ├── store
    │       ├── contractId.ts
    │       └── keyId.ts
    │   ├── types
    │       ├── Form.types.ts
    │       ├── Utils.types.ts
    │       └── Welcome.types.ts
    │   └── utils
    │       ├── base.ts
    │       ├── chat.ts
    │       ├── passkey-kit.ts
    │       ├── rpc.ts
    │       └── zettablocks.ts
├── tsconfig.json
└── yarn.lock


/.env.example:
--------------------------------------------------------------------------------
 1 | NEXT_PUBLIC_RPC_URL="https://testnet.sorobanrpc.com"
 2 | NEXT_PUBLIC_NETWORK_PASSPHRASE="Public Global Stellar Network ; September 2015"
 3 | NEXT_PUBLIC_CHAT_CONTRACT_ID="CBUMOJAEAPLQUCWVIM6HJH5XKXW5OP7CRVOOYMJYSTZ6GFDNA72O2QW6"
 4 | NEXT_PUBLIC_CHAT_CONTRACT_START_LEDGER=589387
 5 | NEXT_PUBLIC_WALLET_WASM_HASH="ecd990f0b45ca6817149b6175f79b32efb442f35731985a084131e8265c4cd90"
 6 | NEXT_PUBLIC_LAUNCHTUBE_URL="https://launchtube.xyz"
 7 | NEXT_PUBLIC_LAUNCHTUBE_JWT=""
 8 | NEXT_PUBLIC_ZETTA_BLOCK_API_URL="https://api.zettablock.com/api/v1/dataset/sq_811b432cc7e5423ab39973c44519fec6/graphql"
 9 | NEXT_PUBLIC_ZETTA_BLOCK_API_KEY=
10 | 


--------------------------------------------------------------------------------
/.gitignore:
--------------------------------------------------------------------------------
  1 | # Logs
  2 | logs
  3 | *.log
  4 | npm-debug.log*
  5 | yarn-debug.log*
  6 | yarn-error.log*
  7 | lerna-debug.log*
  8 | .pnpm-debug.log*
  9 | 
 10 | # Diagnostic reports (https://nodejs.org/api/report.html)
 11 | report.[0-9]*.[0-9]*.[0-9]*.[0-9]*.json
 12 | 
 13 | # Runtime data
 14 | pids
 15 | *.pid
 16 | *.seed
 17 | *.pid.lock
 18 | 
 19 | # Directory for instrumented libs generated by jscoverage/JSCover
 20 | lib-cov
 21 | 
 22 | # Coverage directory used by tools like istanbul
 23 | coverage
 24 | *.lcov
 25 | 
 26 | # nyc test coverage
 27 | .nyc_output
 28 | 
 29 | # Grunt intermediate storage (https://gruntjs.com/creating-plugins#storing-task-files)
 30 | .grunt
 31 | 
 32 | # Bower dependency directory (https://bower.io/)
 33 | bower_components
 34 | 
 35 | # node-waf configuration
 36 | .lock-wscript
 37 | 
 38 | # Compiled binary addons (https://nodejs.org/api/addons.html)
 39 | build/Release
 40 | 
 41 | # Dependency directories
 42 | node_modules/
 43 | jspm_packages/
 44 | 
 45 | # Snowpack dependency directory (https://snowpack.dev/)
 46 | web_modules/
 47 | 
 48 | # TypeScript cache
 49 | *.tsbuildinfo
 50 | 
 51 | # Optional npm cache directory
 52 | .npm
 53 | 
 54 | # Optional eslint cache
 55 | .eslintcache
 56 | 
 57 | # Optional stylelint cache
 58 | .stylelintcache
 59 | 
 60 | # Microbundle cache
 61 | .rpt2_cache/
 62 | .rts2_cache_cjs/
 63 | .rts2_cache_es/
 64 | .rts2_cache_umd/
 65 | 
 66 | # Optional REPL history
 67 | .node_repl_history
 68 | 
 69 | # Output of 'npm pack'
 70 | *.tgz
 71 | 
 72 | # Yarn Integrity file
 73 | .yarn-integrity
 74 | 
 75 | # dotenv environment variable files
 76 | .env
 77 | .env.development.local
 78 | .env.test.local
 79 | .env.production.local
 80 | .env.local
 81 | 
 82 | # parcel-bundler cache (https://parceljs.org/)
 83 | .cache
 84 | .parcel-cache
 85 | 
 86 | # Next.js build output
 87 | .next
 88 | out
 89 | 
 90 | # Nuxt.js build / generate output
 91 | .nuxt
 92 | dist
 93 | 
 94 | # Gatsby files
 95 | .cache/
 96 | # Comment in the public line in if your project uses Gatsby and not Next.js
 97 | # https://nextjs.org/blog/next-9-1#public-directory-support
 98 | # public
 99 | 
100 | # vuepress build output
101 | .vuepress/dist
102 | 
103 | # vuepress v2.x temp and cache directory
104 | .temp
105 | .cache
106 | 
107 | # vitepress build output
108 | **/.vitepress/dist
109 | 
110 | # vitepress cache directory
111 | **/.vitepress/cache
112 | 
113 | # Docusaurus cache and generated files
114 | .docusaurus
115 | 
116 | # Serverless directories
117 | .serverless/
118 | 
119 | # FuseBox cache
120 | .fusebox/
121 | 
122 | # DynamoDB Local files
123 | .dynamodb/
124 | 
125 | # TernJS port file
126 | .tern-port
127 | 
128 | # Stores VSCode versions used for testing VSCode extensions
129 | .vscode-test
130 | .idea
131 | 
132 | # yarn v2
133 | .yarn/cache
134 | .yarn/unplugged
135 | .yarn/build-state.yml
136 | .yarn/install-state.gz
137 | .pnp.*
138 | 


--------------------------------------------------------------------------------
/Dockerfile:
--------------------------------------------------------------------------------
 1 | # syntax=docker.io/docker/dockerfile:1
 2 | 
 3 | FROM node:18-alpine AS base
 4 | 
 5 | # Install dependencies only when needed
 6 | FROM base AS deps
 7 | # Check https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine to understand why libc6-compat might be needed.
 8 | RUN apk add --no-cache libc6-compat
 9 | WORKDIR /app
10 | 
11 | # Install dependencies based on the preferred package manager
12 | COPY package.json yarn.lock* package-lock.json* pnpm-lock.yaml* .npmrc* ./
13 | RUN \
14 |   if [ -f yarn.lock ]; then yarn --frozen-lockfile; \
15 |   elif [ -f package-lock.json ]; then npm ci; \
16 |   elif [ -f pnpm-lock.yaml ]; then corepack enable pnpm && pnpm i --frozen-lockfile; \
17 |   else echo "Lockfile not found." && exit 1; \
18 |   fi
19 | 
20 | 
21 | # Rebuild the source code only when needed
22 | FROM base AS builder
23 | WORKDIR /app
24 | COPY --from=deps /app/node_modules ./node_modules
25 | COPY . .
26 | 
27 | # Next.js collects completely anonymous telemetry data about general usage.
28 | # Learn more here: https://nextjs.org/telemetry
29 | # Uncomment the following line in case you want to disable telemetry during the build.
30 | # ENV NEXT_TELEMETRY_DISABLED=1
31 | 
32 | RUN \
33 |   if [ -f yarn.lock ]; then yarn run build; \
34 |   elif [ -f package-lock.json ]; then npm run build; \
35 |   elif [ -f pnpm-lock.yaml ]; then corepack enable pnpm && pnpm run build; \
36 |   else echo "Lockfile not found." && exit 1; \
37 |   fi
38 | 
39 | # Production image, copy all the files and run next
40 | FROM base AS runner
41 | WORKDIR /app
42 | 
43 | ENV NODE_ENV=production
44 | # Uncomment the following line in case you want to disable telemetry during runtime.
45 | # ENV NEXT_TELEMETRY_DISABLED=1
46 | 
47 | RUN addgroup --system --gid 1001 nodejs
48 | RUN adduser --system --uid 1001 nextjs
49 | 
50 | COPY --from=builder /app/public ./public
51 | 
52 | # Automatically leverage output traces to reduce image size
53 | # https://nextjs.org/docs/advanced-features/output-file-tracing
54 | COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
55 | COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static
56 | 
57 | USER nextjs
58 | 
59 | EXPOSE 3000
60 | 
61 | ENV PORT=3000
62 | 
63 | # server.js is created by next build from the standalone output
64 | # https://nextjs.org/docs/pages/api-reference/config/next-config-js/output
65 | ENV HOSTNAME="0.0.0.0"
66 | CMD ["node", "server.js"]


--------------------------------------------------------------------------------
/LICENSE:
--------------------------------------------------------------------------------
  1 |                                  Apache License
  2 |                            Version 2.0, January 2004
  3 |                         http://www.apache.org/licenses/
  4 | 
  5 |    TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION
  6 | 
  7 |    1. Definitions.
  8 | 
  9 |       "License" shall mean the terms and conditions for use, reproduction,
 10 |       and distribution as defined by Sections 1 through 9 of this document.
 11 | 
 12 |       "Licensor" shall mean the copyright owner or entity authorized by
 13 |       the copyright owner that is granting the License.
 14 | 
 15 |       "Legal Entity" shall mean the union of the acting entity and all
 16 |       other entities that control, are controlled by, or are under common
 17 |       control with that entity. For the purposes of this definition,
 18 |       "control" means (i) the power, direct or indirect, to cause the
 19 |       direction or management of such entity, whether by contract or
 20 |       otherwise, or (ii) ownership of fifty percent (50%) or more of the
 21 |       outstanding shares, or (iii) beneficial ownership of such entity.
 22 | 
 23 |       "You" (or "Your") shall mean an individual or Legal Entity
 24 |       exercising permissions granted by this License.
 25 | 
 26 |       "Source" form shall mean the preferred form for making modifications,
 27 |       including but not limited to software source code, documentation
 28 |       source, and configuration files.
 29 | 
 30 |       "Object" form shall mean any form resulting from mechanical
 31 |       transformation or translation of a Source form, including but
 32 |       not limited to compiled object code, generated documentation,
 33 |       and conversions to other media types.
 34 | 
 35 |       "Work" shall mean the work of authorship, whether in Source or
 36 |       Object form, made available under the License, as indicated by a
 37 |       copyright notice that is included in or attached to the work
 38 |       (an example is provided in the Appendix below).
 39 | 
 40 |       "Derivative Works" shall mean any work, whether in Source or Object
 41 |       form, that is based on (or derived from) the Work and for which the
 42 |       editorial revisions, annotations, elaborations, or other modifications
 43 |       represent, as a whole, an original work of authorship. For the purposes
 44 |       of this License, Derivative Works shall not include works that remain
 45 |       separable from, or merely link (or bind by name) to the interfaces of,
 46 |       the Work and Derivative Works thereof.
 47 | 
 48 |       "Contribution" shall mean any work of authorship, including
 49 |       the original version of the Work and any modifications or additions
 50 |       to that Work or Derivative Works thereof, that is intentionally
 51 |       submitted to Licensor for inclusion in the Work by the copyright owner
 52 |       or by an individual or Legal Entity authorized to submit on behalf of
 53 |       the copyright owner. For the purposes of this definition, "submitted"
 54 |       means any form of electronic, verbal, or written communication sent
 55 |       to the Licensor or its representatives, including but not limited to
 56 |       communication on electronic mailing lists, source code control systems,
 57 |       and issue tracking systems that are managed by, or on behalf of, the
 58 |       Licensor for the purpose of discussing and improving the Work, but
 59 |       excluding communication that is conspicuously marked or otherwise
 60 |       designated in writing by the copyright owner as "Not a Contribution."
 61 | 
 62 |       "Contributor" shall mean Licensor and any individual or Legal Entity
 63 |       on behalf of whom a Contribution has been received by Licensor and
 64 |       subsequently incorporated within the Work.
 65 | 
 66 |    2. Grant of Copyright License. Subject to the terms and conditions of
 67 |       this License, each Contributor hereby grants to You a perpetual,
 68 |       worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 69 |       copyright license to reproduce, prepare Derivative Works of,
 70 |       publicly display, publicly perform, sublicense, and distribute the
 71 |       Work and such Derivative Works in Source or Object form.
 72 | 
 73 |    3. Grant of Patent License. Subject to the terms and conditions of
 74 |       this License, each Contributor hereby grants to You a perpetual,
 75 |       worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 76 |       (except as stated in this section) patent license to make, have made,
 77 |       use, offer to sell, sell, import, and otherwise transfer the Work,
 78 |       where such license applies only to those patent claims licensable
 79 |       by such Contributor that are necessarily infringed by their
 80 |       Contribution(s) alone or by combination of their Contribution(s)
 81 |       with the Work to which such Contribution(s) was submitted. If You
 82 |       institute patent litigation against any entity (including a
 83 |       cross-claim or counterclaim in a lawsuit) alleging that the Work
 84 |       or a Contribution incorporated within the Work constitutes direct
 85 |       or contributory patent infringement, then any patent licenses
 86 |       granted to You under this License for that Work shall terminate
 87 |       as of the date such litigation is filed.
 88 | 
 89 |    4. Redistribution. You may reproduce and distribute copies of the
 90 |       Work or Derivative Works thereof in any medium, with or without
 91 |       modifications, and in Source or Object form, provided that You
 92 |       meet the following conditions:
 93 | 
 94 |       (a) You must give any other recipients of the Work or
 95 |           Derivative Works a copy of this License; and
 96 | 
 97 |       (b) You must cause any modified files to carry prominent notices
 98 |           stating that You changed the files; and
 99 | 
100 |       (c) You must retain, in the Source form of any Derivative Works
101 |           that You distribute, all copyright, patent, trademark, and
102 |           attribution notices from the Source form of the Work,
103 |           excluding those notices that do not pertain to any part of
104 |           the Derivative Works; and
105 | 
106 |       (d) If the Work includes a "NOTICE" text file as part of its
107 |           distribution, then any Derivative Works that You distribute must
108 |           include a readable copy of the attribution notices contained
109 |           within such NOTICE file, excluding those notices that do not
110 |           pertain to any part of the Derivative Works, in at least one
111 |           of the following places: within a NOTICE text file distributed
112 |           as part of the Derivative Works; within the Source form or
113 |           documentation, if provided along with the Derivative Works; or,
114 |           within a display generated by the Derivative Works, if and
115 |           wherever such third-party notices normally appear. The contents
116 |           of the NOTICE file are for informational purposes only and
117 |           do not modify the License. You may add Your own attribution
118 |           notices within Derivative Works that You distribute, alongside
119 |           or as an addendum to the NOTICE text from the Work, provided
120 |           that such additional attribution notices cannot be construed
121 |           as modifying the License.
122 | 
123 |       You may add Your own copyright statement to Your modifications and
124 |       may provide additional or different license terms and conditions
125 |       for use, reproduction, or distribution of Your modifications, or
126 |       for any such Derivative Works as a whole, provided Your use,
127 |       reproduction, and distribution of the Work otherwise complies with
128 |       the conditions stated in this License.
129 | 
130 |    5. Submission of Contributions. Unless You explicitly state otherwise,
131 |       any Contribution intentionally submitted for inclusion in the Work
132 |       by You to the Licensor shall be under the terms and conditions of
133 |       this License, without any additional terms or conditions.
134 |       Notwithstanding the above, nothing herein shall supersede or modify
135 |       the terms of any separate license agreement you may have executed
136 |       with Licensor regarding such Contributions.
137 | 
138 |    6. Trademarks. This License does not grant permission to use the trade
139 |       names, trademarks, service marks, or product names of the Licensor,
140 |       except as required for reasonable and customary use in describing the
141 |       origin of the Work and reproducing the content of the NOTICE file.
142 | 
143 |    7. Disclaimer of Warranty. Unless required by applicable law or
144 |       agreed to in writing, Licensor provides the Work (and each
145 |       Contributor provides its Contributions) on an "AS IS" BASIS,
146 |       WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
147 |       implied, including, without limitation, any warranties or conditions
148 |       of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
149 |       PARTICULAR PURPOSE. You are solely responsible for determining the
150 |       appropriateness of using or redistributing the Work and assume any
151 |       risks associated with Your exercise of permissions under this License.
152 | 
153 |    8. Limitation of Liability. In no event and under no legal theory,
154 |       whether in tort (including negligence), contract, or otherwise,
155 |       unless required by applicable law (such as deliberate and grossly
156 |       negligent acts) or agreed to in writing, shall any Contributor be
157 |       liable to You for damages, including any direct, indirect, special,
158 |       incidental, or consequential damages of any character arising as a
159 |       result of this License or out of the use or inability to use the
160 |       Work (including but not limited to damages for loss of goodwill,
161 |       work stoppage, computer failure or malfunction, or any and all
162 |       other commercial damages or losses), even if such Contributor
163 |       has been advised of the possibility of such damages.
164 | 
165 |    9. Accepting Warranty or Additional Liability. While redistributing
166 |       the Work or Derivative Works thereof, You may choose to offer,
167 |       and charge a fee for, acceptance of support, warranty, indemnity,
168 |       or other liability obligations and/or rights consistent with this
169 |       License. However, in accepting such obligations, You may act only
170 |       on Your own behalf and on Your sole responsibility, not on behalf
171 |       of any other Contributor, and only if You agree to indemnify,
172 |       defend, and hold each Contributor harmless for any liability
173 |       incurred by, or claims asserted against, such Contributor by reason
174 |       of your accepting any such warranty or additional liability.
175 | 
176 |    END OF TERMS AND CONDITIONS
177 | 
178 |    APPENDIX: How to apply the Apache License to your work.
179 | 
180 |       To apply the Apache License to your work, attach the following
181 |       boilerplate notice, with the fields enclosed by brackets "[]"
182 |       replaced with your own identifying information. (Don't include
183 |       the brackets!)  The text should be enclosed in the appropriate
184 |       comment syntax for the file format. We also recommend that a
185 |       file or class name and description of purpose be included on the
186 |       same "printed page" as the copyright notice for easier
187 |       identification within third-party archives.
188 | 
189 |    Copyright [yyyy] [name of copyright owner]
190 | 
191 |    Licensed under the Apache License, Version 2.0 (the "License");
192 |    you may not use this file except in compliance with the License.
193 |    You may obtain a copy of the License at
194 | 
195 |        http://www.apache.org/licenses/LICENSE-2.0
196 | 
197 |    Unless required by applicable law or agreed to in writing, software
198 |    distributed under the License is distributed on an "AS IS" BASIS,
199 |    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
200 |    See the License for the specific language governing permissions and
201 |    limitations under the License.
202 | 


--------------------------------------------------------------------------------
/README.md:
--------------------------------------------------------------------------------
  1 | # Stellar Smart Contract Demo: React & Next.js Front-end
  2 | 
  3 | Learn how to build a dApp front-end on the ✨ [Stellar Network](https://developers.stellar.org/)
  4 | with [smart wallets](https://developers.stellar.org/docs/build/apps/smart-wallets)
  5 | powered by Stellar Dev Tools
  6 | like the **Stellar CLI**, the **Stellar Javascript SDK**, **Passkey Kit** and **Launchtube**.
  7 | 
  8 | With a front-end built with **React** and **Next.js** with **Zustand** for state management.
  9 | 
 10 | This example builds on the contract and UI from [kalepail/smart-stellar-demo](https://github.com/kalepail/smart-stellar-demo)
 11 | 
 12 | **🛠️ Dev Tools**
 13 | 
 14 | - 💻 [Stellar CLI](https://developers.stellar.org/docs/tools/cli/install-cli)
 15 | 	- Featuring: [Generating Bindings](https://developers.stellar.org/docs/tools/cli/stellar-cli#stellar-contract-bindings)
 16 | - ⚙️ [Stellar Javascript SDK](https://developers.stellar.org/docs/tools/sdks/client-sdks#javascript-sdk)
 17 | 	- Featuring: [Stellar RPC Server](https://stellar.github.io/js-stellar-sdk/module-rpc.Server.html)
 18 | - 🔐 [Passkey Kit](https://github.com/kalepail/passkey-kit) - Seamless authentication
 19 | - 🚀 [Launchtube](https://github.com/stellar/launchtube) - Transaction submission and paymaster functionality
 20 | 
 21 | ---
 22 | 
 23 | ### 🔐 Passkey Kit: Simplifying UX
 24 | 
 25 | [Passkey Kit GitHub Repository](https://github.com/kalepail/passkey-kit)
 26 | 
 27 | Self-custody is too complicated for users.
 28 | 
 29 | **Passkey Kit** streamlines user experience leveraging biometric authentication for signing and
 30 | fine-grained authorization of Stellar transactions
 31 | with [Policy Signers](https://github.com/kalepail/passkey-kit/tree/next/contracts/sample-policy).
 32 | 
 33 | ---
 34 | 
 35 | ### 🚀 Launchtube: Get your Operation On-Chain
 36 | 
 37 | [Launchtube GitHub Repository](https://github.com/stellar/launchtube)
 38 | 
 39 | Launchtube is a super cool service that abstracts away the complexity of
 40 | submitting transactions.
 41 | 
 42 | 1. **Transaction Lifecycle Management**:
 43 | 	- Transaction Submission
 44 | 	- Retries
 45 | 	- Working around rate limits
 46 | 
 47 | 2. **Paymaster Service**:
 48 | 	- Pays transaction fees
 49 | 
 50 | ---
 51 | 
 52 | ## ✨ Stellar Smart Contract React & Next.js Demo
 53 | 
 54 | Secure, passkey-powered, chat messages.
 55 | 
 56 | ## Polling for Events
 57 | 
 58 | **Make a Remote Procedure Call(RPC) with:**
 59 | 
 60 | - [Stellar CLI](https://github.com/stellar/stellar-cli)
 61 | - Using [Stellar Lab](https://lab.stellar.org/)
 62 | 
 63 | **Using a `start-ledger` parameter:**
 64 | 
 65 | ```bash
 66 | stellar events \
 67 | 	--network testnet \
 68 |     --start-ledger 589386 \
 69 |     --id CBUMOJAEAPLQUCWVIM6HJH5XKXW5OP7CRVOOYMJYSTZ6GFDNA72O2QW6 \
 70 |     --output pretty
 71 | ```
 72 | 
 73 | **Using Stellar Lab**
 74 | [Stellar lab getEvents request](https://lab.stellar.org/endpoints/rpc/get-events?$=network$id=testnet&label=Testnet&horizonUrl=https:////horizon-testnet.stellar.org&rpcUrl=https:////testnet.rpciege.com//&passphrase=Test%20SDF%20Network%20/;%20September%202015;&endpoints$params$startLedger=589386&limit=10&filters=%7B%22type%22:%22contract%22,%22contract_ids%22:%5B%22CBUMOJAEAPLQUCWVIM6HJH5XKXW5OP7CRVOOYMJYSTZ6GFDNA72O2QW6%22%5D,%22topics%22:%5B%22%22%5D%7D)
 75 | 
 76 | ### Understanding the `getEvents()` RPC Response
 77 | 
 78 | JSON response for [Get Events RPC Call](https://developers.stellar.org/docs/data/apis/rpc/api-reference/methods/getEvents):
 79 | 
 80 | ```json
 81 | {
 82 |   "jsonrpc": "2.0",
 83 |   "id": 8675309,
 84 |   "result": {
 85 | 	"events": [
 86 | 	  {
 87 | 		"type": "contract",
 88 | 		"ledger": 589387,
 89 | 		"ledgerClosedAt": "2025-04-22T20:52:41Z",
 90 | 		"contractId": "CBUMOJAEAPLQUCWVIM6HJH5XKXW5OP7CRVOOYMJYSTZ6GFDNA72O2QW6",
 91 | 		"id": "0002531397889695744-0000000001",
 92 | 		"pagingToken": "0002531397889695744-0000000001",
 93 | 		"inSuccessfulContractCall": true,
 94 | 		"txHash": "86ad86ba26466e50b764cb7c0dab1082a5e1eec4e1cc82ae2bade7fbeb5d143f",
 95 | 		"topic": [
 96 | 		  "AAAAEgAAAAAAAAAAxJYJmGjzotfUZImIspIV+7UI2gWeEsNcIDRS4CIg2FE="
 97 | 		],
 98 | 		"value": "AAAADgAAABB0ZXN0LW1zZy10by1zZW5k"
 99 | 	  }
100 | 	],
101 | 	"latestLedger": 589890,
102 | 	"cursor": "0002533562553204735-4294967295"
103 |   }
104 | }
105 | ```
106 | 
107 | **Topic Field: `ScVal` representing the Address:**
108 | Path:  `result.events.topic`
109 | 
110 | ```terminaloutput
111 | AAAAEgAAAAAAAAAAxJYJmGjzotfUZImIspIV+7UI2gWeEsNcIDRS4CIg2FE=
112 | ```
113 | 
114 | **Decoded Event Topic: `ScVal` JSON representing an Address:**
115 | 
116 | ```json
117 | {
118 |   "address": "GDCJMCMYNDZ2FV6UMSEYRMUSCX53KCG2AWPBFQ24EA2FFYBCEDMFCBCV"
119 | }
120 | ```
121 | 
122 | **XDR Value Field: `ScVal` representing the message payload:**
123 | Path:  `result.events.value`
124 | 
125 | ```terminaloutput
126 | AAAADgAAABB0ZXN0LW1zZy10by1zZW5k
127 | ```
128 | 
129 | **Decoded JSON:**
130 | 
131 | ```json
132 | {
133 |   "string": "test-msg-to-send"
134 | }
135 | ```
136 | 
137 | ## Rpc Server - Retrieve and Process Contract Events
138 | 
139 | Path:  `src/app/utils/rpc.ts`
140 | Uses the [Stellar Javascript SDK](https://stellar.github.io/js-stellar-sdk/)
141 | 
142 | **Contract Event Retrieval**:
143 | 
144 | - Fetches contract events
145 | - Filters events by contract ID, topic and validates data integrity
146 | - Converts `Api.GetEventsResponse` into structured `ChatEvent` objects
147 | - ChatEvent type defined in `src/app/types/Utils.types.ts`
148 | 
149 | **Fetch Contract Events:**
150 | 
151 | - Instantiate RPC Server
152 | 
153 | ```typescript
154 | export const rpc = new Server(process.env.NEXT_PUBLIC_RPC_URL!);
155 | ```
156 | 
157 | - Call Get Events RPC call
158 | 
159 | ```typescript
160 | export async function getEvents(msgs: ChatEvent[], limit: number | string, found: boolean = false) {
161 |     await rpc.getEvents ({});
162 | }
163 | ```
164 | 
165 | **Filter Events by Contract ID:**
166 | 
167 | Get events for deployed contract using `contract` filter.
168 | 
169 | - Pass in contract `filter`s array `filters: []`
170 | - Import deployed contract ID from env `process.env.NEXT_PUBLIC_CHAT_CONTRACT_ID!`
171 | - Set `startLedger` or `cursor`
172 | - Set`limit` or max returned values
173 | 
174 | ```typescript
175 | await rpc.getEvents(
176 |     {
177 | 		// Set events filters
178 | 		filters: [
179 |             // Filter for contract events of deployed contract
180 | 			{
181 | 				type: "contract",
182 | 				contractIds: [process.env.NEXT_PUBLIC_CHAT_CONTRACT_ID!],
183 | 			},
184 | 		],
185 | 		// Ledger # to start return events from
186 | 		startLedger: typeof limit === "number" ? limit : undefined,
187 | 		// Max number of returned entries
188 | 		limit: 10_000,
189 | 		// Cursor to start looking at events from
190 | 		cursor: typeof limit === "string" ? limit : undefined,
191 | 	}
192 | )
193 | ```
194 | 
195 | **Convert from GetEvent API Response to Chat Event Object:**
196 |  
197 | _Take raw RPC GetEvent responses, validate and convert data for local UI usage._ 
198 | 
199 | - Validate event type is `contract` and `contractId` is present
200 | - Get `Address` from first entry in event topic array `event.topic[0].address()`
201 | - Output as publicKey type `Ed25519` for `scAddressTypeAccount` type
202 | - Or contractId for `scAddressTypeContract` type
203 | 
204 | ```typescript
205 | // Loop through events return by `getEvents()` rpc call
206 | events.forEach((event) => {
207 |     // Verify event type and contractId
208 | 	if (event.type !== "contract" || !event.contractId) return;
209 | 
210 | 	if (msgs.findIndex(({ id }) => id === event.id) === -1) {
211 | 		let addr: string | undefined;
212 |         // Get Address from first entry in event topic array
213 | 		const topic0 = event.topic[0].address();
214 | 
215 | 		switch (topic0.switch().name) {
216 |             // Return ed25519 accountId string 
217 | 			case "scAddressTypeAccount": {
218 | 				addr = Address.account(
219 | 						topic0.accountId().ed25519(),
220 | 				).toString();
221 | 				break;
222 | 			}
223 |             // Return contractId address string
224 | 			case "scAddressTypeContract": {
225 | 				addr = Address.contract(
226 | 						topic0.contractId(),
227 | 				).toString();
228 | 				break;
229 | 			}
230 | 		}
231 | 	}
232 | });
233 | ```
234 | 
235 | **Create `ChatEvent` from RPC Contract Event data**
236 | 
237 | _Take extracted fields from raw getEvents() response and create Chat Event._
238 | 
239 | - `ChatEvent` interface defined in `src/app/types/Utils.types.ts`
240 | - Set fields in `ChatEvent`:
241 | 	- id as `string`
242 | 	- addr as `string`
243 | 	- timestamp as `Date`
244 | 	- txHash as `string`
245 | 	- msg as `string`
246 | 
247 | ```typescript
248 | // Add to msgs array
249 | msgs.push(
250 |     // Create `ChatEvent` from extracted data from event
251 |     {
252 |     	id: event.id,
253 |     	addr,
254 |     	timestamp: new Date(event.ledgerClosedAt),
255 |     	txHash: event.txHash,
256 |     	msg: scValToNative(event.value),
257 | 	} as ChatEvent
258 | );
259 | ```
260 | 
261 | ### Configuration Options
262 | 
263 | - `_limit`: Maximum number of events to retrieve per request (default: 1,000)
264 | - Environment variables from `.env`:
265 | 	- `NEXT_PUBLIC_RPC_URL`: The URL of the Stellar RPC server
266 | 	- `NEXT_PUBLIC_NETWORK_PASSPHRASE`: The network passphrase for the target Stellar network
267 | 	- `NEXT_PUBLIC_CHAT_CONTRACT_ID`: The default contract ID to filter events
268 |     - `NEXT_PUBLIC_CHAT_CONTRACT_START_LEDGER` : Stat ledger for RPC call
269 | 
270 | ## Front-End UI Code
271 | 
272 | Running the next.js/React project with `pnpm`
273 | 
274 | ### 🛠 PNPM Commands
275 | 
276 | Run from the root directory of the project:
277 | 
278 | | Command                    | Action                                       |
279 | |:---------------------------|:---------------------------------------------|
280 | | `pnpm install`             | Installs dependencies                        |
281 | | `pnpm dev`                 | Starts local dev server at `localhost:3000`  |
282 |  
283 | Now let's review the 3 React components `Form`, `Header` and `Welcome`.
284 | 
285 | - `src/app/components/Form.tsx` - Used to submit Chat messages
286 | - `src/app/components/Header.tsx` - Used to login with Passkeys
287 | - `src/app/components/Welcome.tsx` - Used to display Chat messages
288 | 
289 | ---
290 | 
291 | ### React Component Header.tsx
292 | 
293 | Facilitates creation of passkey accounts with Passkey's kit.
294 | 
295 | Review the following file:
296 | `src/app/components/Header.tsx`
297 | 
298 | ```typescript
299 | async function signUp() {
300 |     // Set icon
301 | 	setCreating(true);
302 | 
303 | 	try {
304 | 		// PasskeyKit initialized in src/app/utils/passkey-kit.ts used to create smart wallet
305 | 		const {
306 | 			keyIdBase64,
307 | 			contractId: cid,
308 | 			signedTx,
309 | 		} = await account.createWallet("Smart Stellar Demo", "Smart Stellar Demo User");
310 | 
311 |         // Launchtube server initialized in src/app/utils/passkey-kit.ts
312 | 		await server.send(signedTx);
313 | 
314 |         // Store passkey keyId in local storage
315 | 		updateKeyId(keyIdBase64);
316 | 		localStorage.setItem("ssd:keyId", keyIdBase64);
317 | 
318 | 		updateContractId(cid)
319 | 	} finally {
320 | 		setCreating(false);
321 | 	}
322 | }
323 | ```
324 | 
325 | ---
326 | 
327 | ### React Component Welcome.tsx
328 | 
329 | Let's walk through how `ChatEvent`s are displayed in the UI.
330 | 
331 | Review the following file:
332 | `src/app/components/Welcome.tsx`
333 | 
334 | This component prints out the chat messages stored in state:
335 | 
336 | - Setup and configure state management
337 | - Import `getEvents` and `rpc` from `src/app/utils/rpc.ts`
338 | - Setup `useEffect()` React hook to schedule state update event
339 | - Use `rpc.getLatestLedger()` to create 24 lookback period
340 | - Call `getEvents()` rpc function 
341 | - Merge chat messages into existing array: `mergedArray = [...messages, ...msgs]`
342 | - De-duplicate messages using map with unique keys
343 | - Sort messages by Timestamp
344 | - Set messages in `zustand` state `setMessages(messages => {})`
345 | 
346 | **Configure State**
347 | 
348 | Messages are stored in state as an array in `zustand`:
349 | ```typescript
350 | 	// Setup and configure state management
351 |     const [messages, setMessages] = useState([{
352 | 	id: "",
353 | 	addr: "",
354 | 	timestamp: new Date,
355 | 	txHash: "",
356 | 	msg: "",
357 | }]);
358 | ```
359 | 
360 | **Set React Hook: useEffect()**
361 | 
362 |  - Use React Hook to trigger call to rpc server
363 |  - https://react.dev/reference/react/useEffect
364 |  - Sync chat message data displayed in UI with emitted contract events
365 | 
366 | ```typescript jsx
367 | // Setup React hook
368 | useEffect(() => {
369 | 	async function eventInterval() {
370 | 
371 |         // Determine ledger sequence for 24 hour lookback period
372 | 		const { sequence } = await rpc.getLatestLedger();
373 | 		await callGetEvents(sequence - 17_280); // last 24 hrs
374 | 
375 | 		// Setup interval for updating state with rpc getEvents() call
376 | 		interval = setInterval(async () => {
377 | 			const { sequence } = await rpc.getLatestLedger();
378 | 			await callGetEvents(sequence - 17_280); // last 24 hrs
379 | 			console.log('timer');
380 | 		}, 12_000); // 12_000 = 5 times per minute
381 | 	}
382 | 	eventInterval();
383 | 
384 | 	return () => {
385 | 		if (interval) clearInterval(interval);
386 | 	};
387 | }, []);
388 | ```
389 | 
390 | **Update State with Sorted Unique Map of Messages**
391 | 
392 | - Get Events
393 | - Merge chat & de-dupe messages
394 | - Sort by Timestamp then set messages state
395 | 
396 | ```typescript jsx
397 | // Function to update state with rpc getEvents() call
398 | async function callGetEvents(
399 | 		limit: number | string,
400 | 		found: boolean = false,
401 | ) {
402 |     // Call getEvents() rpc function
403 | 	msgs = await getEvents(msgs, limit, found);
404 | 
405 |     // Update zustand state with sorted, unique map of messages
406 | 	setMessages(messages => {
407 | 		const mergedArray = [...messages, ...msgs];
408 | 		const uniqueMap = new Map();
409 | 		const key = 'id';
410 | 
411 | 		for (const item of mergedArray) {
412 | 			uniqueMap.set(item[key], item);
413 | 		}
414 | 
415 |         // Sort messages by timestamp
416 | 		const sortedUniqueMap = Array.from(uniqueMap.values()).sort(
417 | 				(a, b) => a.timestamp.getTime() - b.timestamp.getTime(),
418 | 		);
419 | 
420 | 		return sortedUniqueMap;
421 | 	});
422 | }
423 | ```
424 | 
425 | **Updating the UI**
426 | 
427 | Updating the UI in response to changes in the state.
428 | 
429 | **Loop through msgs array and display `ChatEvent` in UI:**
430 | 
431 | - Use React JSX expression language
432 | - Use `messages.map` to iterate over messages stored in state
433 | - Print out `ChatEvent` message fields embedded in styled HTML
434 | - Each message is enclosed in a unordered list elements `<li>`
435 | 
436 | ```typescript jsx
437 | <ul>
438 | 	{messages.map((msg, i) => (
439 | 	<li className="mb-2" key={i}>
440 | 		<span className="text-mono text-sm bg-black rounded-t-lg text-white px-3 py-1">
441 | 			
442 | 			<a className="underline"
443 | 			   target="_blank"
444 | 			   href={"https://stellar.expert/explorer/public/tx/" + msg.txHash}>
445 | 				{truncate(msg.addr, 4)}
446 |             </a>
447 | 			
448 | 			<time className="text-xs text-gray-400">
449 | 				{msg.timestamp.toLocaleTimeString()}
450 |             </time>
451 |         </span>
452 | 		<p className="min-w-[220px] text-pretty break-words bg-gray-200 px-3 py-1 rounded-b-lg rounded-tr-lg border border-gray-400">
453 | 			{msg.msg}
454 | 		</p>
455 | 	</li>
456 | 	))}
457 | </ul>
458 | ```
459 | 
460 | ### React Component Form.tsx
461 | 
462 | Let's walk through how the `MessageForm` component is used to send messages
463 | 
464 | Review the following file:
465 | `src/app/components/Form.tsx`
466 | 
467 | - `src/app/utils/chat.ts` configures `Client` from `chat-demo-sdk` contract bindings
468 | - `chat-demo-sdk` bindings were generated with Stellar CLI
469 | 	- Review `chat-demo-sdk/README.md` for more info
470 | - Client configured in `chat.ts` with `rpcUrl`, `contractId` and `networkPassphrase` from `.env` params
471 | - Invoke deployed contract `chat.send()` function, passing in `addr` and `msg` string
472 | - Sign `AssembledTransaction` with `PasskeyKit` Signer passing in `keyId` and transaction to `sign()` function
473 | - This will then prompt your browser to request your fingerprint
474 | - Use the Launchtube `PasskeyServer` configured with `rpcUrl`, `launchtubeUrl` and `launchtubeJwt`
475 | - Await JSON response from Launchtube server
476 | 
477 | ```typescript jsx
478 | // Define onSubmit action for React Form
479 | async function onSubmit(event: FormEvent<HTMLFormElement>) {
480 |     
481 |     // Get form data from React FormEvent data
482 | 	let msg = formData.get('msg') as string;
483 | 	const formKeyId = formData.get('kid') as string;
484 | 	const formContractId = formData.get('cid') as string;
485 | 
486 |     // Assemble chat.send() contract function invocation with client contract bindings
487 |     let at = await chat.send(
488 |         {
489 | 			addr: formContractId,
490 | 			msg,
491 | 		});
492 | 
493 |     	// Sign assembled transaction with Passkey Kit
494 | 		at = await account.sign(at, { keyId: formKeyId });
495 | 
496 |         // Send transaction with Launchtube
497 | 		await server.send(at);
498 | }
499 | ```
500 | 
501 | ---
502 | 
503 | For more details on how Passkeys and Launchtube work check out the example repo: https://github.com/kalepail/smart-stellar-demo
504 | 
505 | ## 👀 Want to learn more?
506 | 
507 | Feel free to check [our documentation](https://developers.stellar.org/) or jump into
508 | our [Discord server](https://discord.gg/stellardev).
509 | 
510 | ---
511 | 


--------------------------------------------------------------------------------
/chat-demo-sdk/README.md:
--------------------------------------------------------------------------------
 1 | # chat-demo-sdk JS
 2 | 
 3 | JS library for interacting with [Soroban](https://soroban.stellar.org/) smart contract `chat-demo-sdk` via Soroban RPC.
 4 | 
 5 | This library was automatically generated by Soroban CLI using a command similar to:
 6 | 
 7 | ```bash
 8 | soroban contract bindings ts \
 9 |   --rpc-url INSERT_RPC_URL_HERE \
10 |   --network-passphrase "INSERT_NETWORK_PASSPHRASE_HERE" \
11 |   --contract-id INSERT_CONTRACT_ID_HERE \
12 |   --output-dir ./path/to/chat-demo-sdk
13 | ```
14 | 
15 | The network passphrase and contract ID are exported from [index.ts](./src/index.ts) in the `networks` constant. If you are the one who generated this library and you know that this contract is also deployed to other networks, feel free to update `networks` with other valid options. This will help your contract consumers use this library more easily.
16 | 
17 | # To publish or not to publish
18 | 
19 | This library is suitable for publishing to NPM. You can publish it to NPM using the `npm publish` command.
20 | 
21 | But you don't need to publish this library to NPM to use it. You can add it to your project's `package.json` using a file path:
22 | 
23 | ```json
24 | "dependencies": {
25 |   "chat-demo-sdk": "./path/to/this/folder"
26 | }
27 | ```
28 | 
29 | However, we've actually encountered [frustration](https://github.com/stellar/soroban-example-dapp/pull/117#discussion_r1232873560) using local libraries with NPM in this way. Though it seems a bit messy, we suggest generating the library directly to your `node_modules` folder automatically after each install by using a `postinstall` script. We've had the least trouble with this approach. NPM will automatically remove what it sees as erroneous directories during the `install` step, and then regenerate them when it gets to your `postinstall` step, which will keep the library up-to-date with your contract.
30 | 
31 | ```json
32 | "scripts": {
33 |   "postinstall": "soroban contract bindings ts --rpc-url INSERT_RPC_URL_HERE --network-passphrase \"INSERT_NETWORK_PASSPHRASE_HERE\" --id INSERT_CONTRACT_ID_HERE --name chat-demo-sdk"
34 | }
35 | ```
36 | 
37 | Obviously you need to adjust the above command based on the actual command you used to generate the library.
38 | 
39 | # Use it
40 | 
41 | Now that you have your library up-to-date and added to your project, you can import it in a file and see inline documentation for all of its exported methods:
42 | 
43 | ```js
44 | import { Contract, networks } from "chat-demo-sdk"
45 | 
46 | const contract = new Contract({
47 |   ...networks.futurenet, // for example; check which networks this library exports
48 |   rpcUrl: '...', // use your own, or find one for testing at https://soroban.stellar.org/docs/reference/rpc#public-rpc-providers
49 | })
50 | 
51 | contract.|
52 | ```
53 | 
54 | As long as your editor is configured to show JavaScript/TypeScript documentation, you can pause your typing at that `|` to get a list of all exports and inline-documentation for each. It exports a separate [async](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function) function for each method in the smart contract, with documentation for each generated from the comments the contract's author included in the original source code.
55 | 


--------------------------------------------------------------------------------
/chat-demo-sdk/dist/index.d.ts:
--------------------------------------------------------------------------------
 1 | import { Buffer } from "buffer";
 2 | import { AssembledTransaction, Client as ContractClient, ClientOptions as ContractClientOptions, MethodOptions } from '@stellar/stellar-sdk/minimal/contract';
 3 | export declare const Errors: {};
 4 | export interface Client {
 5 |     /**
 6 |      * Construct and simulate a send transaction. Returns an `AssembledTransaction` object which will have a `result` field containing the result of the simulation. If this transaction changes contract state, you will need to call `signAndSend()` on the returned object.
 7 |      */
 8 |     send: ({ addr, msg }: {
 9 |         addr: string;
10 |         msg: string;
11 |     }, options?: {
12 |         /**
13 |          * The fee to pay for the transaction. Default: BASE_FEE
14 |          */
15 |         fee?: number;
16 |         /**
17 |          * The maximum amount of time to wait for the transaction to complete. Default: DEFAULT_TIMEOUT
18 |          */
19 |         timeoutInSeconds?: number;
20 |         /**
21 |          * Whether to automatically simulate the transaction when constructing the AssembledTransaction. Default: true
22 |          */
23 |         simulate?: boolean;
24 |     }) => Promise<AssembledTransaction<null>>;
25 | }
26 | export declare class Client extends ContractClient {
27 |     readonly options: ContractClientOptions;
28 |     static deploy<T = Client>(
29 |     /** Options for initalizing a Client as well as for calling a method, with extras specific to deploying. */
30 |     options: MethodOptions & Omit<ContractClientOptions, "contractId"> & {
31 |         /** The hash of the Wasm blob, which must already be installed on-chain. */
32 |         wasmHash: Buffer | string;
33 |         /** Salt used to generate the contract's ID. Passed through to {@link Operation.createCustomContract}. Default: random. */
34 |         salt?: Buffer | Uint8Array;
35 |         /** The format used to decode `wasmHash`, if it's provided as a string. */
36 |         format?: "hex" | "base64";
37 |     }): Promise<AssembledTransaction<T>>;
38 |     constructor(options: ContractClientOptions);
39 |     readonly fromJSON: {
40 |         send: (json: string) => AssembledTransaction<null>;
41 |     };
42 | }
43 | 


--------------------------------------------------------------------------------
/chat-demo-sdk/dist/index.js:
--------------------------------------------------------------------------------
 1 | import { Buffer } from "buffer";
 2 | import { Client as ContractClient, Spec as ContractSpec, } from '@stellar/stellar-sdk/minimal/contract';
 3 | if (typeof window !== 'undefined') {
 4 |     //@ts-ignore Buffer exists
 5 |     window.Buffer = window.Buffer || Buffer;
 6 | }
 7 | export const Errors = {};
 8 | export class Client extends ContractClient {
 9 |     options;
10 |     static async deploy(
11 |     /** Options for initalizing a Client as well as for calling a method, with extras specific to deploying. */
12 |     options) {
13 |         return ContractClient.deploy(null, options);
14 |     }
15 |     constructor(options) {
16 |         super(new ContractSpec(["AAAAAAAAAAAAAAAEc2VuZAAAAAIAAAAAAAAABGFkZHIAAAATAAAAAAAAAANtc2cAAAAAEAAAAAA="]), options);
17 |         this.options = options;
18 |     }
19 |     fromJSON = {
20 |         send: (this.txFromJSON)
21 |     };
22 | }
23 | 


--------------------------------------------------------------------------------
/chat-demo-sdk/package.json:
--------------------------------------------------------------------------------
 1 | {
 2 |   "version": "0.0.0",
 3 |   "name": "chat-demo-sdk",
 4 |   "type": "module",
 5 |   "exports": "./dist/index.js",
 6 |   "typings": "dist/index.d.ts",
 7 |   "scripts": {
 8 |     "build": "tsc"
 9 |   },
10 |   "dependencies": {
11 |     "@stellar/stellar-sdk": "^13.2.0",
12 |     "buffer": "^6.0.3"
13 |   },
14 |   "devDependencies": {
15 |     "typescript": "^5.8.3"
16 |   }
17 | }
18 | 


--------------------------------------------------------------------------------
/chat-demo-sdk/pnpm-lock.yaml:
--------------------------------------------------------------------------------
  1 | lockfileVersion: '9.0'
  2 | 
  3 | settings:
  4 |   autoInstallPeers: true
  5 |   excludeLinksFromLockfile: false
  6 | 
  7 | importers:
  8 | 
  9 |   .:
 10 |     dependencies:
 11 |       '@stellar/stellar-sdk':
 12 |         specifier: ^13.2.0
 13 |         version: 13.2.0
 14 |       buffer:
 15 |         specifier: ^6.0.3
 16 |         version: 6.0.3
 17 |     devDependencies:
 18 |       typescript:
 19 |         specifier: ^5.8.3
 20 |         version: 5.8.3
 21 | 
 22 | packages:
 23 | 
 24 |   '@stellar/js-xdr@3.1.2':
 25 |     resolution: {integrity: sha512-VVolPL5goVEIsvuGqDc5uiKxV03lzfWdvYg1KikvwheDmTBO68CKDji3bAZ/kppZrx5iTA8z3Ld5yuytcvhvOQ==}
 26 | 
 27 |   '@stellar/stellar-base@13.1.0':
 28 |     resolution: {integrity: sha512-90EArG+eCCEzDGj3OJNoCtwpWDwxjv+rs/RNPhvg4bulpjN/CSRj+Ys/SalRcfM4/WRC5/qAfjzmJBAuquWhkA==}
 29 |     engines: {node: '>=18.0.0'}
 30 | 
 31 |   '@stellar/stellar-sdk@13.2.0':
 32 |     resolution: {integrity: sha512-azxeh1+mS28h96Q+vl41ffytQvWdudRl1KtjYO0TRZb/9u0/lH57oYBeJ+gvcQr+T7s02wTayFdHbKru5V5/XA==}
 33 |     engines: {node: '>=18.0.0'}
 34 | 
 35 |   asynckit@0.4.0:
 36 |     resolution: {integrity: sha512-Oei9OH4tRh0YqU3GxhX79dM/mwVgvbZJaSNaRk+bshkj0S5cfHcgYakreBjrHwatXKbz+IoIdYLxrKim2MjW0Q==}
 37 | 
 38 |   axios@1.8.4:
 39 |     resolution: {integrity: sha512-eBSYY4Y68NNlHbHBMdeDmKNtDgXWhQsJcGqzO3iLUM0GraQFSS9cVgPX5I9b3lbdFKyYoAEGAZF1DwhTaljNAw==}
 40 | 
 41 |   bare-addon-resolve@1.9.4:
 42 |     resolution: {integrity: sha512-unn6Vy/Yke6F99vg/7tcrvM2KUvIhTNniaSqDbam4AWkd4NhvDVSrQiRYVlNzUV2P7SPobkCK7JFVxrJk9btCg==}
 43 |     peerDependencies:
 44 |       bare-url: '*'
 45 |     peerDependenciesMeta:
 46 |       bare-url:
 47 |         optional: true
 48 | 
 49 |   bare-module-resolve@1.10.2:
 50 |     resolution: {integrity: sha512-C9COe/GhWfVXKytW3DElTkiBU+Gb2OXeaVkdGdRB/lp26TVLESHkTGS876iceAGdvtPgohfp9nX8vXHGvN3++Q==}
 51 |     peerDependencies:
 52 |       bare-url: '*'
 53 |     peerDependenciesMeta:
 54 |       bare-url:
 55 |         optional: true
 56 | 
 57 |   bare-os@3.6.1:
 58 |     resolution: {integrity: sha512-uaIjxokhFidJP+bmmvKSgiMzj2sV5GPHaZVAIktcxcpCyBFFWO+YlikVAdhmUo2vYFvFhOXIAlldqV29L8126g==}
 59 |     engines: {bare: '>=1.14.0'}
 60 | 
 61 |   bare-path@3.0.0:
 62 |     resolution: {integrity: sha512-tyfW2cQcB5NN8Saijrhqn0Zh7AnFNsnczRcuWODH0eYAXBsJ5gVxAUuNr7tsHSC6IZ77cA0SitzT+s47kot8Mw==}
 63 | 
 64 |   bare-semver@1.0.1:
 65 |     resolution: {integrity: sha512-UtggzHLiTrmFOC/ogQ+Hy7VfoKoIwrP1UFcYtTxoCUdLtsIErT8+SWtOC2DH/snT9h+xDrcBEPcwKei1mzemgg==}
 66 | 
 67 |   bare-url@2.1.5:
 68 |     resolution: {integrity: sha512-lNImB5KLN+ggw+SYDYvqf/yCizXIyq8U/nWBlx7m4pc4TKS24SB/1WWskzGacon5cVVAC6qUzCYzI/aMYCf4Ng==}
 69 | 
 70 |   base32.js@0.1.0:
 71 |     resolution: {integrity: sha512-n3TkB02ixgBOhTvANakDb4xaMXnYUVkNoRFJjQflcqMQhyEKxEHdj3E6N8t8sUQ0mjH/3/JxzlXuz3ul/J90pQ==}
 72 |     engines: {node: '>=0.12.0'}
 73 | 
 74 |   base64-js@1.5.1:
 75 |     resolution: {integrity: sha512-AKpaYlHn8t4SVbOHCy+b5+KKgvR4vrsD8vbvrbiQJps7fKDTkjkDry6ji0rUJjC0kzbNePLwzxq8iypo41qeWA==}
 76 | 
 77 |   bignumber.js@9.3.0:
 78 |     resolution: {integrity: sha512-EM7aMFTXbptt/wZdMlBv2t8IViwQL+h6SLHosp8Yf0dqJMTnY6iL32opnAB6kAdL0SZPuvcAzFr31o0c/R3/RA==}
 79 | 
 80 |   buffer@6.0.3:
 81 |     resolution: {integrity: sha512-FTiCpNxtwiZZHEZbcbTIcZjERVICn9yq/pDFkTl95/AxzD1naBctN7YO68riM/gLSDY7sdrMby8hofADYuuqOA==}
 82 | 
 83 |   call-bind-apply-helpers@1.0.2:
 84 |     resolution: {integrity: sha512-Sp1ablJ0ivDkSzjcaJdxEunN5/XvksFJ2sMBFfq6x0ryhQV/2b/KwFe21cMpmHtPOSij8K99/wSfoEuTObmuMQ==}
 85 |     engines: {node: '>= 0.4'}
 86 | 
 87 |   combined-stream@1.0.8:
 88 |     resolution: {integrity: sha512-FQN4MRfuJeHf7cBbBMJFXhKSDq+2kAArBlmRBvcvFE5BB1HZKXtSFASDhdlz9zOYwxh8lDdnvmMOe/+5cdoEdg==}
 89 |     engines: {node: '>= 0.8'}
 90 | 
 91 |   delayed-stream@1.0.0:
 92 |     resolution: {integrity: sha512-ZySD7Nf91aLB0RxL4KGrKHBXl7Eds1DAmEdcoVawXnLD7SDhpNgtuII2aAkg7a7QS41jxPSZ17p4VdGnMHk3MQ==}
 93 |     engines: {node: '>=0.4.0'}
 94 | 
 95 |   dunder-proto@1.0.1:
 96 |     resolution: {integrity: sha512-KIN/nDJBQRcXw0MLVhZE9iQHmG68qAVIBg9CqmUYjmQIhgij9U5MFvrqkUL5FbtyyzZuOeOt0zdeRe4UY7ct+A==}
 97 |     engines: {node: '>= 0.4'}
 98 | 
 99 |   es-define-property@1.0.1:
100 |     resolution: {integrity: sha512-e3nRfgfUZ4rNGL232gUgX06QNyyez04KdjFrF+LTRoOXmrOgFKDg4BCdsjW8EnT69eqdYGmRpJwiPVYNrCaW3g==}
101 |     engines: {node: '>= 0.4'}
102 | 
103 |   es-errors@1.3.0:
104 |     resolution: {integrity: sha512-Zf5H2Kxt2xjTvbJvP2ZWLEICxA6j+hAmMzIlypy4xcBg1vKVnx89Wy0GbS+kf5cwCVFFzdCFh2XSCFNULS6csw==}
105 |     engines: {node: '>= 0.4'}
106 | 
107 |   es-object-atoms@1.1.1:
108 |     resolution: {integrity: sha512-FGgH2h8zKNim9ljj7dankFPcICIK9Cp5bm+c2gQSYePhpaG5+esrLODihIorn+Pe6FGJzWhXQotPv73jTaldXA==}
109 |     engines: {node: '>= 0.4'}
110 | 
111 |   es-set-tostringtag@2.1.0:
112 |     resolution: {integrity: sha512-j6vWzfrGVfyXxge+O0x5sh6cvxAog0a/4Rdd2K36zCMV5eJ+/+tOAngRO8cODMNWbVRdVlmGZQL2YS3yR8bIUA==}
113 |     engines: {node: '>= 0.4'}
114 | 
115 |   eventsource@2.0.2:
116 |     resolution: {integrity: sha512-IzUmBGPR3+oUG9dUeXynyNmf91/3zUSJg1lCktzKw47OXuhco54U3r9B7O4XX+Rb1Itm9OZ2b0RkTs10bICOxA==}
117 |     engines: {node: '>=12.0.0'}
118 | 
119 |   feaxios@0.0.23:
120 |     resolution: {integrity: sha512-eghR0A21fvbkcQBgZuMfQhrXxJzC0GNUGC9fXhBge33D+mFDTwl0aJ35zoQQn575BhyjQitRc5N4f+L4cP708g==}
121 | 
122 |   follow-redirects@1.15.9:
123 |     resolution: {integrity: sha512-gew4GsXizNgdoRyqmyfMHyAmXsZDk6mHkSxZFCzW9gwlbtOW44CDtYavM+y+72qD/Vq2l550kMF52DT8fOLJqQ==}
124 |     engines: {node: '>=4.0'}
125 |     peerDependencies:
126 |       debug: '*'
127 |     peerDependenciesMeta:
128 |       debug:
129 |         optional: true
130 | 
131 |   form-data@4.0.2:
132 |     resolution: {integrity: sha512-hGfm/slu0ZabnNt4oaRZ6uREyfCj6P4fT/n6A1rGV+Z0VdGXjfOhVUpkn6qVQONHGIFwmveGXyDs75+nr6FM8w==}
133 |     engines: {node: '>= 6'}
134 | 
135 |   function-bind@1.1.2:
136 |     resolution: {integrity: sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==}
137 | 
138 |   get-intrinsic@1.3.0:
139 |     resolution: {integrity: sha512-9fSjSaos/fRIVIp+xSJlE6lfwhES7LNtKaCBIamHsjr2na1BiABJPo0mOjjz8GJDURarmCPGqaiVg5mfjb98CQ==}
140 |     engines: {node: '>= 0.4'}
141 | 
142 |   get-proto@1.0.1:
143 |     resolution: {integrity: sha512-sTSfBjoXBp89JvIKIefqw7U2CCebsc74kiY6awiGogKtoSGbgjYE/G/+l9sF3MWFPNc9IcoOC4ODfKHfxFmp0g==}
144 |     engines: {node: '>= 0.4'}
145 | 
146 |   gopd@1.2.0:
147 |     resolution: {integrity: sha512-ZUKRh6/kUFoAiTAtTYPZJ3hw9wNxx+BIBOijnlG9PnrJsCcSjs1wyyD6vJpaYtgnzDrKYRSqf3OO6Rfa93xsRg==}
148 |     engines: {node: '>= 0.4'}
149 | 
150 |   has-symbols@1.1.0:
151 |     resolution: {integrity: sha512-1cDNdwJ2Jaohmb3sg4OmKaMBwuC48sYni5HUw2DvsC8LjGTLK9h+eb1X6RyuOHe4hT0ULCW68iomhjUoKUqlPQ==}
152 |     engines: {node: '>= 0.4'}
153 | 
154 |   has-tostringtag@1.0.2:
155 |     resolution: {integrity: sha512-NqADB8VjPFLM2V0VvHUewwwsw0ZWBaIdgo+ieHtK3hasLz4qeCRjYcqfB6AQrBggRKppKF8L52/VqdVsO47Dlw==}
156 |     engines: {node: '>= 0.4'}
157 | 
158 |   hasown@2.0.2:
159 |     resolution: {integrity: sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==}
160 |     engines: {node: '>= 0.4'}
161 | 
162 |   ieee754@1.2.1:
163 |     resolution: {integrity: sha512-dcyqhDvX1C46lXZcVqCpK+FtMRQVdIMN6/Df5js2zouUsqG7I6sFxitIC+7KYK29KdXOLHdu9zL4sFnoVQnqaA==}
164 | 
165 |   inherits@2.0.4:
166 |     resolution: {integrity: sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==}
167 | 
168 |   is-retry-allowed@3.0.0:
169 |     resolution: {integrity: sha512-9xH0xvoggby+u0uGF7cZXdrutWiBiaFG8ZT4YFPXL8NzkyAwX3AKGLeFQLvzDpM430+nDFBZ1LHkie/8ocL06A==}
170 |     engines: {node: '>=12'}
171 | 
172 |   math-intrinsics@1.1.0:
173 |     resolution: {integrity: sha512-/IXtbwEk5HTPyEwyKX6hGkYXxM9nbj64B+ilVJnC/R6B0pH5G4V3b0pVbL7DBj4tkhBAppbQUlf6F6Xl9LHu1g==}
174 |     engines: {node: '>= 0.4'}
175 | 
176 |   mime-db@1.52.0:
177 |     resolution: {integrity: sha512-sPU4uV7dYlvtWJxwwxHD0PuihVNiE7TyAbQ5SWxDCB9mUYvOgroQOwYQQOKPJ8CIbE+1ETVlOoK1UC2nU3gYvg==}
178 |     engines: {node: '>= 0.6'}
179 | 
180 |   mime-types@2.1.35:
181 |     resolution: {integrity: sha512-ZDY+bPm5zTTF+YpCrAU9nK0UgICYPT0QtT1NZWFv4s++TNkcgVaT0g6+4R2uI4MjQjzysHB1zxuWL50hzaeXiw==}
182 |     engines: {node: '>= 0.6'}
183 | 
184 |   proxy-from-env@1.1.0:
185 |     resolution: {integrity: sha512-D+zkORCbA9f1tdWRK0RaCR3GPv50cMxcrz4X8k5LTSUD1Dkw47mKJEZQNunItRTkWwgtaUSo1RVFRIG9ZXiFYg==}
186 | 
187 |   randombytes@2.1.0:
188 |     resolution: {integrity: sha512-vYl3iOX+4CKUWuxGi9Ukhie6fsqXqS9FE2Zaic4tNFD2N2QQaXOMFbuKK4QmDHC0JO6B1Zp41J0LpT0oR68amQ==}
189 | 
190 |   require-addon@1.1.0:
191 |     resolution: {integrity: sha512-KbXAD5q2+v1GJnkzd8zzbOxchTkStSyJZ9QwoCq3QwEXAaIlG3wDYRZGzVD357jmwaGY7hr5VaoEAL0BkF0Kvg==}
192 |     engines: {bare: '>=1.10.0'}
193 | 
194 |   safe-buffer@5.2.1:
195 |     resolution: {integrity: sha512-rp3So07KcdmmKbGvgaNxQSJr7bGVSVk5S9Eq1F+ppbRo70+YeaDxkw5Dd8NPN+GD6bjnYm2VuPuCXmpuYvmCXQ==}
196 | 
197 |   sha.js@2.4.11:
198 |     resolution: {integrity: sha512-QMEp5B7cftE7APOjk5Y6xgrbWu+WkLVQwk8JNjZ8nKRciZaByEW6MubieAiToS7+dwvrjGhH8jRXz3MVd0AYqQ==}
199 |     hasBin: true
200 | 
201 |   sodium-native@4.3.3:
202 |     resolution: {integrity: sha512-OnxSlN3uyY8D0EsLHpmm2HOFmKddQVvEMmsakCrXUzSd8kjjbzL413t4ZNF3n0UxSwNgwTyUvkmZHTfuCeiYSw==}
203 | 
204 |   toml@3.0.0:
205 |     resolution: {integrity: sha512-y/mWCZinnvxjTKYhJ+pYxwD0mRLVvOtdS2Awbgxln6iEnt4rk0yBxeSBHkGJcPucRiG0e55mwWp+g/05rsrd6w==}
206 | 
207 |   tweetnacl@1.0.3:
208 |     resolution: {integrity: sha512-6rt+RN7aOi1nGMyC4Xa5DdYiukl2UWCbcJft7YhxReBGQD7OAM8Pbxw6YMo4r2diNEA8FEmu32YOn9rhaiE5yw==}
209 | 
210 |   typescript@5.8.3:
211 |     resolution: {integrity: sha512-p1diW6TqL9L07nNxvRMM7hMMw4c5XOo/1ibL4aAIGmSAt9slTE1Xgw5KWuof2uTOvCg9BY7ZRi+GaF+7sfgPeQ==}
212 |     engines: {node: '>=14.17'}
213 |     hasBin: true
214 | 
215 |   urijs@1.19.11:
216 |     resolution: {integrity: sha512-HXgFDgDommxn5/bIv0cnQZsPhHDA90NPHD6+c/v21U5+Sx5hoP8+dP9IZXBU1gIfvdRfhG8cel9QNPeionfcCQ==}
217 | 
218 | snapshots:
219 | 
220 |   '@stellar/js-xdr@3.1.2': {}
221 | 
222 |   '@stellar/stellar-base@13.1.0':
223 |     dependencies:
224 |       '@stellar/js-xdr': 3.1.2
225 |       base32.js: 0.1.0
226 |       bignumber.js: 9.3.0
227 |       buffer: 6.0.3
228 |       sha.js: 2.4.11
229 |       tweetnacl: 1.0.3
230 |     optionalDependencies:
231 |       sodium-native: 4.3.3
232 | 
233 |   '@stellar/stellar-sdk@13.2.0':
234 |     dependencies:
235 |       '@stellar/stellar-base': 13.1.0
236 |       axios: 1.8.4
237 |       bignumber.js: 9.3.0
238 |       eventsource: 2.0.2
239 |       feaxios: 0.0.23
240 |       randombytes: 2.1.0
241 |       toml: 3.0.0
242 |       urijs: 1.19.11
243 |     transitivePeerDependencies:
244 |       - debug
245 | 
246 |   asynckit@0.4.0: {}
247 | 
248 |   axios@1.8.4:
249 |     dependencies:
250 |       follow-redirects: 1.15.9
251 |       form-data: 4.0.2
252 |       proxy-from-env: 1.1.0
253 |     transitivePeerDependencies:
254 |       - debug
255 | 
256 |   bare-addon-resolve@1.9.4(bare-url@2.1.5):
257 |     dependencies:
258 |       bare-module-resolve: 1.10.2(bare-url@2.1.5)
259 |       bare-semver: 1.0.1
260 |     optionalDependencies:
261 |       bare-url: 2.1.5
262 |     optional: true
263 | 
264 |   bare-module-resolve@1.10.2(bare-url@2.1.5):
265 |     dependencies:
266 |       bare-semver: 1.0.1
267 |     optionalDependencies:
268 |       bare-url: 2.1.5
269 |     optional: true
270 | 
271 |   bare-os@3.6.1:
272 |     optional: true
273 | 
274 |   bare-path@3.0.0:
275 |     dependencies:
276 |       bare-os: 3.6.1
277 |     optional: true
278 | 
279 |   bare-semver@1.0.1:
280 |     optional: true
281 | 
282 |   bare-url@2.1.5:
283 |     dependencies:
284 |       bare-path: 3.0.0
285 |     optional: true
286 | 
287 |   base32.js@0.1.0: {}
288 | 
289 |   base64-js@1.5.1: {}
290 | 
291 |   bignumber.js@9.3.0: {}
292 | 
293 |   buffer@6.0.3:
294 |     dependencies:
295 |       base64-js: 1.5.1
296 |       ieee754: 1.2.1
297 | 
298 |   call-bind-apply-helpers@1.0.2:
299 |     dependencies:
300 |       es-errors: 1.3.0
301 |       function-bind: 1.1.2
302 | 
303 |   combined-stream@1.0.8:
304 |     dependencies:
305 |       delayed-stream: 1.0.0
306 | 
307 |   delayed-stream@1.0.0: {}
308 | 
309 |   dunder-proto@1.0.1:
310 |     dependencies:
311 |       call-bind-apply-helpers: 1.0.2
312 |       es-errors: 1.3.0
313 |       gopd: 1.2.0
314 | 
315 |   es-define-property@1.0.1: {}
316 | 
317 |   es-errors@1.3.0: {}
318 | 
319 |   es-object-atoms@1.1.1:
320 |     dependencies:
321 |       es-errors: 1.3.0
322 | 
323 |   es-set-tostringtag@2.1.0:
324 |     dependencies:
325 |       es-errors: 1.3.0
326 |       get-intrinsic: 1.3.0
327 |       has-tostringtag: 1.0.2
328 |       hasown: 2.0.2
329 | 
330 |   eventsource@2.0.2: {}
331 | 
332 |   feaxios@0.0.23:
333 |     dependencies:
334 |       is-retry-allowed: 3.0.0
335 | 
336 |   follow-redirects@1.15.9: {}
337 | 
338 |   form-data@4.0.2:
339 |     dependencies:
340 |       asynckit: 0.4.0
341 |       combined-stream: 1.0.8
342 |       es-set-tostringtag: 2.1.0
343 |       mime-types: 2.1.35
344 | 
345 |   function-bind@1.1.2: {}
346 | 
347 |   get-intrinsic@1.3.0:
348 |     dependencies:
349 |       call-bind-apply-helpers: 1.0.2
350 |       es-define-property: 1.0.1
351 |       es-errors: 1.3.0
352 |       es-object-atoms: 1.1.1
353 |       function-bind: 1.1.2
354 |       get-proto: 1.0.1
355 |       gopd: 1.2.0
356 |       has-symbols: 1.1.0
357 |       hasown: 2.0.2
358 |       math-intrinsics: 1.1.0
359 | 
360 |   get-proto@1.0.1:
361 |     dependencies:
362 |       dunder-proto: 1.0.1
363 |       es-object-atoms: 1.1.1
364 | 
365 |   gopd@1.2.0: {}
366 | 
367 |   has-symbols@1.1.0: {}
368 | 
369 |   has-tostringtag@1.0.2:
370 |     dependencies:
371 |       has-symbols: 1.1.0
372 | 
373 |   hasown@2.0.2:
374 |     dependencies:
375 |       function-bind: 1.1.2
376 | 
377 |   ieee754@1.2.1: {}
378 | 
379 |   inherits@2.0.4: {}
380 | 
381 |   is-retry-allowed@3.0.0: {}
382 | 
383 |   math-intrinsics@1.1.0: {}
384 | 
385 |   mime-db@1.52.0: {}
386 | 
387 |   mime-types@2.1.35:
388 |     dependencies:
389 |       mime-db: 1.52.0
390 | 
391 |   proxy-from-env@1.1.0: {}
392 | 
393 |   randombytes@2.1.0:
394 |     dependencies:
395 |       safe-buffer: 5.2.1
396 | 
397 |   require-addon@1.1.0:
398 |     dependencies:
399 |       bare-addon-resolve: 1.9.4(bare-url@2.1.5)
400 |       bare-url: 2.1.5
401 |     optional: true
402 | 
403 |   safe-buffer@5.2.1: {}
404 | 
405 |   sha.js@2.4.11:
406 |     dependencies:
407 |       inherits: 2.0.4
408 |       safe-buffer: 5.2.1
409 | 
410 |   sodium-native@4.3.3:
411 |     dependencies:
412 |       require-addon: 1.1.0
413 |     optional: true
414 | 
415 |   toml@3.0.0: {}
416 | 
417 |   tweetnacl@1.0.3: {}
418 | 
419 |   typescript@5.8.3: {}
420 | 
421 |   urijs@1.19.11: {}
422 | 


--------------------------------------------------------------------------------
/chat-demo-sdk/src/index.ts:
--------------------------------------------------------------------------------
 1 | import { Buffer } from "buffer";
 2 | import {
 3 |   AssembledTransaction,
 4 |   Client as ContractClient,
 5 |   ClientOptions as ContractClientOptions,
 6 |   MethodOptions,
 7 |   Spec as ContractSpec,
 8 | } from '@stellar/stellar-sdk/minimal/contract';
 9 | 
10 | if (typeof window !== 'undefined') {
11 |   //@ts-ignore Buffer exists
12 |   window.Buffer = window.Buffer || Buffer;
13 | }
14 | 
15 | export const Errors = {
16 | 
17 | }
18 | 
19 | export interface Client {
20 |   /**
21 |    * Construct and simulate a send transaction. Returns an `AssembledTransaction` object which will have a `result` field containing the result of the simulation. If this transaction changes contract state, you will need to call `signAndSend()` on the returned object.
22 |    */
23 |   send: ({ addr, msg }: { addr: string, msg: string }, options?: {
24 |     /**
25 |      * The fee to pay for the transaction. Default: BASE_FEE
26 |      */
27 |     fee?: number;
28 | 
29 |     /**
30 |      * The maximum amount of time to wait for the transaction to complete. Default: DEFAULT_TIMEOUT
31 |      */
32 |     timeoutInSeconds?: number;
33 | 
34 |     /**
35 |      * Whether to automatically simulate the transaction when constructing the AssembledTransaction. Default: true
36 |      */
37 |     simulate?: boolean;
38 |   }) => Promise<AssembledTransaction<null>>
39 | }
40 | export class Client extends ContractClient {
41 |   static async deploy<T = Client>(
42 |     /** Options for initalizing a Client as well as for calling a method, with extras specific to deploying. */
43 |     options: MethodOptions &
44 |       Omit<ContractClientOptions, "contractId"> & {
45 |         /** The hash of the Wasm blob, which must already be installed on-chain. */
46 |         wasmHash: Buffer | string;
47 |         /** Salt used to generate the contract's ID. Passed through to {@link Operation.createCustomContract}. Default: random. */
48 |         salt?: Buffer | Uint8Array;
49 |         /** The format used to decode `wasmHash`, if it's provided as a string. */
50 |         format?: "hex" | "base64";
51 |       }
52 |   ): Promise<AssembledTransaction<T>> {
53 |     return ContractClient.deploy(null, options)
54 |   }
55 |   constructor(public readonly options: ContractClientOptions) {
56 |     super(
57 |       new ContractSpec(["AAAAAAAAAAAAAAAEc2VuZAAAAAIAAAAAAAAABGFkZHIAAAATAAAAAAAAAANtc2cAAAAAEAAAAAA="]),
58 |       options
59 |     )
60 |   }
61 |   public readonly fromJSON = {
62 |     send: this.txFromJSON<null>
63 |   }
64 | }


--------------------------------------------------------------------------------
/chat-demo-sdk/tsconfig.json:
--------------------------------------------------------------------------------
 1 | {
 2 |   "compilerOptions": {
 3 |     /* Visit https://aka.ms/tsconfig to read more about this file */
 4 |     /* Projects */
 5 |     // "incremental": true,                              /* Save .tsbuildinfo files to allow for incremental compilation of projects. */
 6 |     // "composite": true,                                /* Enable constraints that allow a TypeScript project to be used with project references. */
 7 |     // "tsBuildInfoFile": "./.tsbuildinfo",              /* Specify the path to .tsbuildinfo incremental compilation file. */
 8 |     // "disableSourceOfProjectReferenceRedirect": true,  /* Disable preferring source files instead of declaration files when referencing composite projects. */
 9 |     // "disableSolutionSearching": true,                 /* Opt a project out of multi-project reference checking when editing. */
10 |     // "disableReferencedProjectLoad": true,             /* Reduce the number of projects loaded automatically by TypeScript. */
11 |     /* Language and Environment */
12 |     "target": "ESNext", /* Set the JavaScript language version for emitted JavaScript and include compatible library declarations. */
13 |     // "lib": [],                                        /* Specify a set of bundled library declaration files that describe the target runtime environment. */
14 |     // "jsx": "preserve",                                /* Specify what JSX code is generated. */
15 |     // "experimentalDecorators": true,                   /* Enable experimental support for TC39 stage 2 draft decorators. */
16 |     // "emitDecoratorMetadata": true,                    /* Emit design-type metadata for decorated declarations in source files. */
17 |     // "jsxFactory": "",                                 /* Specify the JSX factory function used when targeting React JSX emit, e.g. 'React.createElement' or 'h'. */
18 |     // "jsxFragmentFactory": "",                         /* Specify the JSX Fragment reference used for fragments when targeting React JSX emit e.g. 'React.Fragment' or 'Fragment'. */
19 |     // "jsxImportSource": "",                            /* Specify module specifier used to import the JSX factory functions when using 'jsx: react-jsx*'. */
20 |     // "reactNamespace": "",                             /* Specify the object invoked for 'createElement'. This only applies when targeting 'react' JSX emit. */
21 |     // "noLib": true,                                    /* Disable including any library files, including the default lib.d.ts. */
22 |     // "useDefineForClassFields": true,                  /* Emit ECMAScript-standard-compliant class fields. */
23 |     // "moduleDetection": "auto",                        /* Control what method is used to detect module-format JS files. */
24 |     /* Modules */
25 |     "module": "NodeNext", /* Specify what module code is generated. */
26 |     // "rootDir": "./",                                  /* Specify the root folder within your source files. */
27 |     "moduleResolution": "nodenext", /* Specify how TypeScript looks up a file from a given module specifier. */
28 |     // "baseUrl": "./",                                  /* Specify the base directory to resolve non-relative module names. */
29 |     // "paths": {},                                      /* Specify a set of entries that re-map imports to additional lookup locations. */
30 |     // "rootDirs": [],                                   /* Allow multiple folders to be treated as one when resolving modules. */
31 |     // "typeRoots": [],                                  /* Specify multiple folders that act like './node_modules/@types'. */
32 |     // "types": [],                                      /* Specify type package names to be included without being referenced in a source file. */
33 |     // "allowUmdGlobalAccess": true,                     /* Allow accessing UMD globals from modules. */
34 |     // "moduleSuffixes": [],                             /* List of file name suffixes to search when resolving a module. */
35 |     // "resolveJsonModule": true,                        /* Enable importing .json files. */
36 |     // "noResolve": true,                                /* Disallow 'import's, 'require's or '<reference>'s from expanding the number of files TypeScript should add to a project. */
37 |     /* JavaScript Support */
38 |     // "allowJs": true,                                  /* Allow JavaScript files to be a part of your program. Use the 'checkJS' option to get errors from these files. */
39 |     // "checkJs": true,                                  /* Enable error reporting in type-checked JavaScript files. */
40 |     // "maxNodeModuleJsDepth": 1,                        /* Specify the maximum folder depth used for checking JavaScript files from 'node_modules'. Only applicable with 'allowJs'. */
41 |     /* Emit */
42 |     "declaration": true, /* Generate .d.ts files from TypeScript and JavaScript files in your project. */
43 |     // "declarationMap": true,                           /* Create sourcemaps for d.ts files. */
44 |     // "emitDeclarationOnly": true,                      /* Only output d.ts files and not JavaScript files. */
45 |     // "sourceMap": true,                                /* Create source map files for emitted JavaScript files. */
46 |     // "outFile": "./",                                  /* Specify a file that bundles all outputs into one JavaScript file. If 'declaration' is true, also designates a file that bundles all .d.ts output. */
47 |     "outDir": "./dist", /* Specify an output folder for all emitted files. */
48 |     // "removeComments": true,                           /* Disable emitting comments. */
49 |     // "noEmit": true,                                   /* Disable emitting files from a compilation. */
50 |     // "importHelpers": true,                            /* Allow importing helper functions from tslib once per project, instead of including them per-file. */
51 |     // "importsNotUsedAsValues": "remove",               /* Specify emit/checking behavior for imports that are only used for types. */
52 |     // "downlevelIteration": true,                       /* Emit more compliant, but verbose and less performant JavaScript for iteration. */
53 |     // "sourceRoot": "",                                 /* Specify the root path for debuggers to find the reference source code. */
54 |     // "mapRoot": "",                                    /* Specify the location where debugger should locate map files instead of generated locations. */
55 |     // "inlineSourceMap": true,                          /* Include sourcemap files inside the emitted JavaScript. */
56 |     // "inlineSources": true,                            /* Include source code in the sourcemaps inside the emitted JavaScript. */
57 |     // "emitBOM": true,                                  /* Emit a UTF-8 Byte Order Mark (BOM) in the beginning of output files. */
58 |     // "newLine": "crlf",                                /* Set the newline character for emitting files. */
59 |     // "stripInternal": true,                            /* Disable emitting declarations that have '@internal' in their JSDoc comments. */
60 |     // "noEmitHelpers": true,                            /* Disable generating custom helper functions like '__extends' in compiled output. */
61 |     // "noEmitOnError": true,                            /* Disable emitting files if any type checking errors are reported. */
62 |     // "preserveConstEnums": true,                       /* Disable erasing 'const enum' declarations in generated code. */
63 |     // "declarationDir": "./",                           /* Specify the output directory for generated declaration files. */
64 |     // "preserveValueImports": true,                     /* Preserve unused imported values in the JavaScript output that would otherwise be removed. */
65 |     /* Interop Constraints */
66 |     // "isolatedModules": true,                          /* Ensure that each file can be safely transpiled without relying on other imports. */
67 |     // "allowSyntheticDefaultImports": true,             /* Allow 'import x from y' when a module doesn't have a default export. */
68 |     // "esModuleInterop": true, /* Emit additional JavaScript to ease support for importing CommonJS modules. This enables 'allowSyntheticDefaultImports' for type compatibility. */
69 |     // "preserveSymlinks": true,                         /* Disable resolving symlinks to their realpath. This correlates to the same flag in node. */
70 |     // "forceConsistentCasingInFileNames": true, /* Ensure that casing is correct in imports. */
71 |     /* Type Checking */
72 |     // "strict": true, /* Enable all strict type-checking options. */
73 |     // "noImplicitAny": true,                            /* Enable error reporting for expressions and declarations with an implied 'any' type. */
74 |     "strictNullChecks": true, /* When type checking, take into account 'null' and 'undefined'. */
75 |     // "strictFunctionTypes": true,                      /* When assigning functions, check to ensure parameters and the return values are subtype-compatible. */
76 |     // "strictBindCallApply": true,                      /* Check that the arguments for 'bind', 'call', and 'apply' methods match the original function. */
77 |     // "strictPropertyInitialization": true,             /* Check for class properties that are declared but not set in the constructor. */
78 |     // "noImplicitThis": true,                           /* Enable error reporting when 'this' is given the type 'any'. */
79 |     // "useUnknownInCatchVariables": true,               /* Default catch clause variables as 'unknown' instead of 'any'. */
80 |     // "alwaysStrict": true,                             /* Ensure 'use strict' is always emitted. */
81 |     // "noUnusedLocals": true,                           /* Enable error reporting when local variables aren't read. */
82 |     // "noUnusedParameters": true,                       /* Raise an error when a function parameter isn't read. */
83 |     // "exactOptionalPropertyTypes": true,               /* Interpret optional property types as written, rather than adding 'undefined'. */
84 |     // "noImplicitReturns": true,                        /* Enable error reporting for codepaths that do not explicitly return in a function. */
85 |     // "noFallthroughCasesInSwitch": true,               /* Enable error reporting for fallthrough cases in switch statements. */
86 |     // "noUncheckedIndexedAccess": true,                 /* Add 'undefined' to a type when accessed using an index. */
87 |     // "noImplicitOverride": true,                       /* Ensure overriding members in derived classes are marked with an override modifier. */
88 |     // "noPropertyAccessFromIndexSignature": true,       /* Enforces using indexed accessors for keys declared using an indexed type. */
89 |     // "allowUnusedLabels": true,                        /* Disable error reporting for unused labels. */
90 |     // "allowUnreachableCode": true,                     /* Disable error reporting for unreachable code. */
91 |     /* Completeness */
92 |     // "skipDefaultLibCheck": true,                      /* Skip type checking .d.ts files that are included with TypeScript. */
93 |     "skipLibCheck": true /* Skip type checking all .d.ts files. */
94 |   },
95 |   "include": [
96 |     "src/*"
97 |   ]
98 | }


--------------------------------------------------------------------------------
/eslint.config.mjs:
--------------------------------------------------------------------------------
 1 | import { dirname } from "path";
 2 | import { fileURLToPath } from "url";
 3 | import { FlatCompat } from "@eslint/eslintrc";
 4 | 
 5 | const __filename = fileURLToPath(import.meta.url);
 6 | const __dirname = dirname(__filename);
 7 | 
 8 | const compat = new FlatCompat({
 9 |   baseDirectory: __dirname,
10 | });
11 | 
12 | const eslintConfig = [
13 |   ...compat.extends("next/core-web-vitals", "next/typescript"),
14 | ];
15 | 
16 | export default eslintConfig;
17 | 


--------------------------------------------------------------------------------
/next-env.d.ts:
--------------------------------------------------------------------------------
1 | /// <reference types="next" />
2 | /// <reference types="next/image-types/global" />
3 | 
4 | // NOTE: This file should not be edited
5 | // see https://nextjs.org/docs/app/api-reference/config/typescript for more information.
6 | 


--------------------------------------------------------------------------------
/next.config.ts:
--------------------------------------------------------------------------------
 1 | import type { NextConfig } from "next";
 2 | 
 3 | const nextConfig: NextConfig = {
 4 |   /* config options here */
 5 |   transpilePackages: [
 6 |     'passkey-kit', 
 7 |     'passkey-factory-sdk', 
 8 |     'passkey-kit-sdk',
 9 |     'sac-sdk',
10 |   ],
11 |   output: "standalone"
12 | };
13 | 
14 | export default nextConfig;
15 | 


--------------------------------------------------------------------------------
/package.json:
--------------------------------------------------------------------------------
 1 | {
 2 |   "name": "smart-stellar-demo",
 3 |   "version": "0.1.0",
 4 |   "private": true,
 5 |   "scripts": {
 6 |     "dev": "next dev --turbopack",
 7 |     "build": "next build",
 8 |     "start": "next start",
 9 |     "lint": "next lint"
10 |   },
11 |   "dependencies": {
12 |     "@simplewebauthn/types": "^12.0.0",
13 |     "@stellar/stellar-sdk": "^13.2.0",
14 |     "chat-demo-sdk": "file:./chat-demo-sdk",
15 |     "dotenv": "^16.5.0",
16 |     "next": "15.3.1",
17 |     "passkey-kit": "^0.10.21",
18 |     "react": "^19.0.0",
19 |     "react-dom": "^19.0.0",
20 |     "zustand": "^5.0.3"
21 |   },
22 |   "devDependencies": {
23 |     "@eslint/eslintrc": "^3",
24 |     "@tailwindcss/postcss": "^4",
25 |     "@types/node": "^20",
26 |     "@types/react": "^19",
27 |     "@types/react-dom": "^19",
28 |     "eslint": "^9",
29 |     "eslint-config-next": "15.3.1",
30 |     "tailwindcss": "^4",
31 |     "typescript": "^5"
32 |   }
33 | }
34 | 


--------------------------------------------------------------------------------
/postcss.config.mjs:
--------------------------------------------------------------------------------
1 | const config = {
2 |   plugins: ["@tailwindcss/postcss"],
3 | };
4 | 
5 | export default config;
6 | 


--------------------------------------------------------------------------------
/public/file.svg:
--------------------------------------------------------------------------------
1 | <svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>


--------------------------------------------------------------------------------
/public/globe.svg:
--------------------------------------------------------------------------------
1 | <svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>


--------------------------------------------------------------------------------
/public/next.svg:
--------------------------------------------------------------------------------
1 | <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>


--------------------------------------------------------------------------------
/public/vercel.svg:
--------------------------------------------------------------------------------
1 | <svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>


--------------------------------------------------------------------------------
/public/window.svg:
--------------------------------------------------------------------------------
1 | <svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>


--------------------------------------------------------------------------------
/src/app/components/Form.tsx:
--------------------------------------------------------------------------------
 1 | import React, { FormEvent, useState } from 'react';
 2 | import {useKeyIdStore} from '../store/keyId';
 3 | import {useContractIdStore} from '../store/contractId';
 4 | import { chat } from "../utils/chat";
 5 | import { account, server } from "../utils/passkey-kit";
 6 | 
 7 | let sending = false;
 8 | 
 9 | export default function MessageForm() {
10 |     const [msg, setMsg] = useState("");
11 | 
12 |     async function onSubmit(event: FormEvent<HTMLFormElement>) {
13 |         event.preventDefault()
14 |      
15 |         const formData = new FormData(event.currentTarget)   
16 |         let msg = formData.get('msg') as string;
17 |         const formKeyId = formData.get('kid') as string;
18 |         const formContractId = formData.get('cid') as string;
19 |     
20 |         if (!formContractId || !formKeyId) return {
21 |             addr: '',
22 |             msg: '',
23 |         };
24 |     
25 |         try {
26 |             sending = true;
27 | 
28 |             let at = await chat.send({
29 |                 addr: formContractId,
30 |                 msg,
31 |             });
32 | 
33 |             at = await account.sign(at, { keyId: formKeyId });
34 | 
35 |             await server.send(at);
36 | 
37 |             msg = "";
38 |         } catch (error) {
39 |             console.error("An error occurred:", error);
40 |         } finally {
41 |             sending = false;
42 |         }
43 | 
44 |         setMsg("");    
45 |         return {
46 |             addr: formData.get('addr') as string,
47 |             msg: formData.get('msg') as string,
48 |         }
49 |       }
50 | 
51 |     const keyId = useKeyIdStore((state) => state.keyId)
52 |     const contractId = useContractIdStore((state) => state.contractId)
53 | 
54 |     return (
55 |         <form className="flex flex-col mt-5" onSubmit={onSubmit}>
56 |             <textarea
57 |                 className="border px-3 py-1 mb-2 border-gray-400 rounded-lg"
58 |                 rows={4}
59 |                 name="msg"
60 |                 id="msg"
61 |                 placeholder="Type your message..."
62 |                 value={msg}
63 |                 onChange={(e) => setMsg(e.target.value)}
64 |             ></textarea>
65 |             <input type='hidden' id="kid" name="kid" value={keyId} />
66 |             <input type='hidden' id="cid" name="cid" value={contractId} />
67 |             <div className="flex items-center ml-auto">
68 |                 <button
69 |                     className="bg-black text-white px-2 py-1 text-sm font-mono disabled:bg-gray-400"
70 |                     type="submit"
71 |                     disabled={sending}
72 |                 >
73 |                     Send{sending ? "ing..." : ""}
74 |                 </button>
75 |             </div>
76 |         </form>
77 |     )
78 | }
79 | 


--------------------------------------------------------------------------------
/src/app/components/Header.tsx:
--------------------------------------------------------------------------------
  1 | 'use client';
  2 | import React, { useEffect, useState } from 'react';
  3 | import Link from 'next/link'
  4 | import { account, server } from "../utils/passkey-kit";
  5 | import {useKeyIdStore} from '../store/keyId';
  6 | import {useContractIdStore} from '../store/contractId';
  7 | import { truncate } from "../utils/base";
  8 | 
  9 | export default function Header() {
 10 |     const [creating, setCreating] = useState(false)
 11 | 
 12 |     const contractId = useContractIdStore((state) => state.contractId)
 13 |     const updateContractId = useContractIdStore((state) => state.setContractId)
 14 | 
 15 |     //const keyId = useKeyIdStore((state) => state.keyId)
 16 |     const updateKeyId = useKeyIdStore((state) => state.setKeyId)
 17 | 
 18 |     useEffect(() => {
 19 |         if (localStorage.hasOwnProperty("ssd:keyId")) {
 20 |             updateKeyId(localStorage.getItem("ssd:keyId")!)
 21 |         }
 22 | 
 23 |         return () => {
 24 | 
 25 |         };
 26 |     }, []);
 27 | 
 28 |     async function signUp() {
 29 |         setCreating(true);
 30 | 
 31 |         try {
 32 | 
 33 |             const { 
 34 |                 keyIdBase64,
 35 |                 contractId: cid,
 36 |                 signedTx,
 37 |             } = await account.createWallet("Smart Stellar Demo", "Smart Stellar Demo User");
 38 | 
 39 |             await server.send(signedTx);
 40 | 
 41 |             updateKeyId(keyIdBase64);
 42 |             localStorage.setItem("ssd:keyId", keyIdBase64);
 43 | 
 44 |             updateContractId(cid)
 45 |         } finally {
 46 |             setCreating(false);
 47 |         }
 48 |     }
 49 | 
 50 |     async function login() {
 51 |         const { keyIdBase64, contractId: cid } = await account.connectWallet();
 52 | 
 53 |         updateKeyId(keyIdBase64)
 54 |         localStorage.setItem("ssd:keyId", keyIdBase64);
 55 | 
 56 |         updateContractId(cid);
 57 |     }
 58 | 
 59 |     async function logout() {
 60 |         updateContractId('');
 61 | 
 62 |         Object.keys(localStorage).forEach((key) => {
 63 |             if (key.includes("ssd:")) {
 64 |                 localStorage.removeItem(key);
 65 |             }
 66 |         });
 67 | 
 68 |         Object.keys(sessionStorage).forEach((key) => {
 69 |             if (key.includes("ssd:")) {
 70 |                 sessionStorage.removeItem(key);
 71 |             }
 72 |         });
 73 | 
 74 |         location.reload();
 75 |     }
 76 | 
 77 |     return (
 78 |         <div className="relative p-2 bg-lime-950 text-lime-500">
 79 |             <div className="flex items-center flex-wrap max-w-[1024px] mx-auto">
 80 |                 <h1 className="flex text-xl">
 81 |                     <Link href="/">Smart Stellar Demo</Link>
 82 |                 </h1>
 83 | 
 84 |                 <div className="flex items-center ml-auto">
 85 |                     {contractId ? (
 86 |                         <>
 87 |                             <a
 88 |                                 className="mr-2 font-mono text-sm underline"
 89 |                                 href={"https://stellar.expert/explorer/public/contract/" + contractId}
 90 |                                 target="_blank"
 91 |                             >
 92 |                                     {truncate(contractId, 4)}
 93 |                             </a>
 94 |                             <button
 95 |                                 className="text-lime-950 bg-lime-500 px-2 py-1 ml-2"
 96 |                                 onClick={logout}>
 97 |                                     Logout
 98 |                             </button>
 99 |                         </>
100 |                     ) : (
101 |                         <>
102 |                             <button className="underline mr-2" onClick={login}>Login</button>
103 |                             <button
104 |                                 className="text-lime-950 bg-lime-500 px-2 py-1 disabled:bg-gray-400"
105 |                                 onClick={signUp}
106 |                                 disabled={creating}
107 |                             >
108 |                                 {creating ? "Creating..." : "Create New Account"}
109 |                             </button>
110 |                         </>
111 |                     )}
112 |                 </div>
113 |             </div>
114 |         </div>    
115 |     );
116 | }
117 | 


--------------------------------------------------------------------------------
/src/app/components/Welcome.tsx:
--------------------------------------------------------------------------------
  1 | 'use client';
  2 | import React, { useEffect, useState } from 'react';
  3 | import {useContractIdStore} from '../store/contractId';
  4 | import { ChatEvent } from '../types/Welcome.types';
  5 | import { getMessages } from "../utils/zettablocks";
  6 | import { truncate } from "../utils/base";
  7 | import { getEvents, rpc } from "../utils/rpc";
  8 | import MessageForm from "./Form";
  9 | 
 10 | export default function Welcome() {
 11 |     const [messages, setMessages] = useState([{
 12 |         id: "",
 13 |         addr: "",
 14 |         timestamp: new Date,
 15 |         txHash: "",
 16 |         msg: "",
 17 |     }]);
 18 | 
 19 |     let msgs: ChatEvent[] = [];
 20 |     let interval: NodeJS.Timeout;
 21 |     const contractId = useContractIdStore((state) => state.contractId)
 22 |     
 23 |     useEffect(() => {
 24 |         async function eventInterval() {
 25 |             await callGetMessages();
 26 | 
 27 |             const { sequence } = await rpc.getLatestLedger();
 28 |             await callGetEvents(sequence - 17_280); // last 24 hrs
 29 | 
 30 |             interval = setInterval(async () => {
 31 |                 const { sequence } = await rpc.getLatestLedger();
 32 |                 await callGetEvents(sequence - 17_280); // last 24 hrs
 33 |                 console.log('timer');
 34 |             }, 12_000); // 12_000 = 5 times per minute
 35 | 
 36 |         }
 37 | 
 38 |         eventInterval();
 39 | 
 40 |         return () => {
 41 |             if (interval) clearInterval(interval);
 42 |         };
 43 |     }, []);
 44 | 
 45 |     async function callGetMessages() {
 46 |         let _msgs: ChatEvent[] = await getMessages();
 47 | 
 48 |         _msgs = _msgs.sort(
 49 |             (a, b) => a.timestamp.getTime() - b.timestamp.getTime(),
 50 |         );
 51 | 
 52 |         if (_msgs.length > 0) {
 53 |             setMessages(_msgs);
 54 |         }
 55 |     }
 56 | 
 57 |     async function callGetEvents(
 58 |         limit: number | string,
 59 |         found: boolean = false,
 60 |     ) {
 61 |         msgs = await getEvents(msgs, limit, found);
 62 | 
 63 |         setMessages(messages => {
 64 |             const mergedArray = [...messages, ...msgs];
 65 |             const uniqueMap = new Map();
 66 |             const key = 'id';
 67 |               
 68 |             for (const item of mergedArray) {
 69 |                 uniqueMap.set(item[key], item);
 70 |             }
 71 | 
 72 |             const sortedUniqueMap = Array.from(uniqueMap.values()).sort(
 73 |                 (a, b) => a.timestamp.getTime() - b.timestamp.getTime(),
 74 |             );
 75 | 
 76 |             return sortedUniqueMap;
 77 |         });
 78 |     }
 79 | 
 80 |     return (
 81 |         <div className="flex flex-col min-w-full items-center my-10">
 82 |         {contractId ? (
 83 |         <div className="max-w-[350px] w-full">
 84 |             <ul>
 85 |                 {messages.map((msg, i) => (
 86 |                     <li className="mb-2" key={i}>
 87 |                         <span
 88 |                             className="text-mono text-sm bg-black rounded-t-lg text-white px-3 py-1"
 89 |                         >
 90 |                             <a
 91 |                                 className="underline"
 92 |                                 target="_blank"
 93 |                                 href={"https://stellar.expert/explorer/public/tx/" + msg.txHash}
 94 |                             >
 95 |                                     {truncate(msg.addr, 4)}
 96 |                             </a>
 97 |                             &nbsp; &nbsp;
 98 |                             <time
 99 |                                 className="text-xs text-gray-400"
100 |                             >
101 |                                 {msg.timestamp.toLocaleTimeString()}
102 |                             </time>
103 |                         </span>
104 |                         <p
105 |                             className="min-w-[220px] text-pretty break-words bg-gray-200 px-3 py-1 rounded-b-lg rounded-tr-lg border border-gray-400"
106 |                         >
107 |                             {msg.msg}
108 |                         </p>
109 |                     </li>
110 |                 ))}
111 |             </ul>
112 | 
113 |             <MessageForm />
114 |         </div>
115 |     ) : (
116 |         <h1>Login or create a new account</h1>
117 |     )}
118 |         </div>
119 |     )
120 | }
121 | 


--------------------------------------------------------------------------------
/src/app/favicon.ico:
--------------------------------------------------------------------------------
https://raw.githubusercontent.com/carstenjacobsen/smart-stellar-demo/779e0cc12aac648cb9ccfabc86a468f74b8f6003/src/app/favicon.ico


--------------------------------------------------------------------------------
/src/app/globals.css:
--------------------------------------------------------------------------------
 1 | @import "tailwindcss";
 2 | 
 3 | :root {
 4 |   --background: #ffffff;
 5 |   --foreground: #171717;
 6 | }
 7 | 
 8 | @theme inline {
 9 |   --color-background: var(--background);
10 |   --color-foreground: var(--foreground);
11 |   --font-sans: var(--font-geist-sans);
12 |   --font-mono: var(--font-geist-mono);
13 | }
14 | 
15 | @media (prefers-color-scheme: dark) {
16 |   :root {
17 |     --background: #0a0a0a;
18 |     --foreground: #ededed;
19 |   }
20 | }
21 | 
22 | body {
23 |   background: var(--background);
24 |   color: var(--foreground);
25 |   font-family: Arial, Helvetica, sans-serif;
26 | }
27 | 


--------------------------------------------------------------------------------
/src/app/layout.tsx:
--------------------------------------------------------------------------------
 1 | import type { Metadata } from "next";
 2 | import { Geist, Geist_Mono } from "next/font/google";
 3 | import "./globals.css";
 4 | 
 5 | const geistSans = Geist({
 6 |   variable: "--font-geist-sans",
 7 |   subsets: ["latin"],
 8 | });
 9 | 
10 | const geistMono = Geist_Mono({
11 |   variable: "--font-geist-mono",
12 |   subsets: ["latin"],
13 | });
14 | 
15 | export const metadata: Metadata = {
16 |   title: "Create Next App",
17 |   description: "Generated by create next app",
18 | };
19 | 
20 | export default function RootLayout({
21 |   children,
22 | }: Readonly<{
23 |   children: React.ReactNode;
24 | }>) {
25 |   return (
26 |     <html lang="en">
27 |       <body
28 |         className={`${geistSans.variable} ${geistMono.variable} antialiased`}
29 |       >
30 |         {children}
31 |       </body>
32 |     </html>
33 |   );
34 | }
35 | 


--------------------------------------------------------------------------------
/src/app/page.tsx:
--------------------------------------------------------------------------------
 1 | import Header from "./components/Header";
 2 | import Welcome from "./components/Welcome";
 3 | 
 4 | export default function Home() {
 5 |   return (
 6 |     <div>
 7 |       <Header />
 8 |       <Welcome />
 9 |     </div>
10 |   );
11 | }
12 | 


--------------------------------------------------------------------------------
/src/app/store/contractId.ts:
--------------------------------------------------------------------------------
 1 | import { create } from 'zustand';
 2 | 
 3 | interface State {
 4 |     contractId: string;
 5 | }
 6 | 
 7 | interface Actions {
 8 |     setContractId: (contractId: State['contractId']) => void;
 9 | }
10 | 
11 | export const useContractIdStore = create<State & Actions>((set) => ({
12 |     contractId: '',
13 |     setContractId: (contractId) => set(() => ({ contractId: contractId })),
14 | }));
15 | 
16 | 
17 | 


--------------------------------------------------------------------------------
/src/app/store/keyId.ts:
--------------------------------------------------------------------------------
 1 | import { create } from 'zustand';
 2 | 
 3 | interface State {
 4 |     keyId: string;
 5 | }
 6 | 
 7 | interface Actions {
 8 |     setKeyId: (keyId: State['keyId']) => void;
 9 | }
10 | 
11 | export const useKeyIdStore = create<State & Actions>((set) => ({
12 |     keyId: '',
13 |     setKeyId: (keyId) => set(() => ({ keyId: keyId })),
14 | }));
15 | 
16 | 


--------------------------------------------------------------------------------
/src/app/types/Form.types.ts:
--------------------------------------------------------------------------------
1 | export interface ActionResponse {
2 |     addr: string,
3 |     msg: string,
4 | }
5 | 
6 | 
7 | 


--------------------------------------------------------------------------------
/src/app/types/Utils.types.ts:
--------------------------------------------------------------------------------
 1 | export interface ChatEvent {
 2 |     id: string;
 3 |     addr: string;
 4 |     timestamp: Date;
 5 |     txHash: string;
 6 |     msg: string;
 7 | }
 8 | 
 9 | export interface ZBQuery {
10 |     id: string;
11 |     topic: string;
12 |     topic_raw: string;
13 |     value: string;
14 |     ledger_closed_at: string;
15 |     transaction_hash: string;
16 | }
17 | 


--------------------------------------------------------------------------------
/src/app/types/Welcome.types.ts:
--------------------------------------------------------------------------------
 1 | export interface ChatEvent {
 2 |     id: string;
 3 |     addr: string;
 4 |     timestamp: Date;
 5 |     txHash: string;
 6 |     msg: string;
 7 | }
 8 | 
 9 | export interface ZBQuery {
10 |     id: string;
11 |     topic: string;
12 |     topic_raw: string;
13 |     value: string;
14 |     ledger_closed_at: string;
15 |     transaction_hash: string;
16 | }
17 | 


--------------------------------------------------------------------------------
/src/app/utils/base.ts:
--------------------------------------------------------------------------------
1 | export function truncate(str: string, length: number = 5) {
2 |     return `${str.slice(0, length)}...${str.slice(-length)}`;
3 | }


--------------------------------------------------------------------------------
/src/app/utils/chat.ts:
--------------------------------------------------------------------------------
1 | import { Client } from 'chat-demo-sdk';
2 | 
3 | export const chat = new Client({
4 |     rpcUrl: process.env.NEXT_PUBLIC_RPC_URL!,
5 |     contractId: process.env.NEXT_PUBLIC_CHAT_CONTRACT_ID!,
6 |     networkPassphrase: process.env.NEXT_PUBLIC_NETWORK_PASSPHRASE!,
7 | })
8 | 


--------------------------------------------------------------------------------
/src/app/utils/passkey-kit.ts:
--------------------------------------------------------------------------------
 1 | "use client";
 2 | import { PasskeyKit, PasskeyServer } from "passkey-kit";
 3 | 
 4 | export const account = new PasskeyKit({
 5 |     rpcUrl: process.env.NEXT_PUBLIC_RPC_URL!,
 6 |     networkPassphrase: process.env.NEXT_PUBLIC_NETWORK_PASSPHRASE!,
 7 |     walletWasmHash: process.env.NEXT_PUBLIC_WALLET_WASM_HASH!,
 8 |     timeoutInSeconds: 30,
 9 | });
10 | 
11 | export const server = new PasskeyServer({
12 |     rpcUrl: process.env.PUBLIC_RPC_URL,
13 |     launchtubeUrl: process.env.NEXT_PUBLIC_LAUNCHTUBE_URL,
14 |     launchtubeJwt: process.env.NEXT_PUBLIC_LAUNCHTUBE_JWT,
15 | });


--------------------------------------------------------------------------------
/src/app/utils/rpc.ts:
--------------------------------------------------------------------------------
 1 | import { Address, scValToNative } from "@stellar/stellar-sdk/minimal";
 2 | import { Server } from "@stellar/stellar-sdk/minimal/rpc";
 3 | import { ChatEvent } from "../types/Utils.types";
 4 | 
 5 | export const rpc = new Server(process.env.NEXT_PUBLIC_RPC_URL!);
 6 | 
 7 | export async function getEvents(msgs: ChatEvent[], limit: number | string, found: boolean = false) {
 8 |     await rpc
 9 |         .getEvents({
10 |             filters: [
11 |                 {
12 |                     type: "contract",
13 |                     contractIds: [process.env.NEXT_PUBLIC_CHAT_CONTRACT_ID!],
14 |                 },
15 |             ],
16 |             startLedger: typeof limit === "number" ? limit : undefined,
17 |             limit: 10_000,
18 |             cursor: typeof limit === "string" ? limit : undefined,
19 |         })
20 |         .then(async ({ events, cursor }) => {
21 |             if (events.length === 0) {
22 |                 if (limit === cursor || found) return;
23 |                 return getEvents(msgs, cursor);
24 |             }
25 | 
26 |             events.forEach((event) => {
27 |                 if (event.type !== "contract" || !event.contractId) return;
28 | 
29 |                 if (msgs.findIndex(({ id }) => id === event.id) === -1) {
30 |                     let addr: string | undefined;
31 |                     const topic0 = event.topic[0].address();
32 | 
33 |                     switch (topic0.switch().name) {
34 |                         case "scAddressTypeAccount": {
35 |                             addr = Address.account(
36 |                                 topic0.accountId().ed25519(),
37 |                             ).toString();
38 |                             break;
39 |                         }
40 |                         case "scAddressTypeContract": {
41 |                             addr = Address.contract(
42 |                                 topic0.contractId(),
43 |                             ).toString();
44 |                             break;
45 |                         }
46 |                     }
47 | 
48 |                     msgs.push({
49 |                         id: event.id,
50 |                         addr,
51 |                         timestamp: new Date(event.ledgerClosedAt),
52 |                         txHash: event.txHash,
53 |                         msg: scValToNative(event.value),
54 |                     });
55 |                 }
56 |             });
57 | 
58 |             return getEvents(msgs, cursor, true);
59 |         });
60 | 
61 |     return msgs;
62 | }


--------------------------------------------------------------------------------
/src/app/utils/zettablocks.ts:
--------------------------------------------------------------------------------
 1 | import { scValToNative, xdr } from "@stellar/stellar-sdk/minimal";
 2 | import { ZBQuery } from "../types/Welcome.types";
 3 | 
 4 | export function getMessages() {
 5 |     return fetch(process.env.NEXT_PUBLIC_ZETTA_BLOCK_API_URL!, {
 6 |         method: "POST",
 7 |         headers: {
 8 |             "Content-Type": "application/json",
 9 |             "X-API-KEY": process.env.NEXT_PUBLIC_ZETTA_BLOCK_API_KEY!,
10 |         },
11 |         body: JSON.stringify({
12 |             query: `
13 |                 query MyQuery {
14 |                     records {
15 |                         id
16 |                         topic
17 |                         topic_raw
18 |                         value
19 |                         ledger_closed_at
20 |                         transaction_hash
21 |                     }
22 |                 }
23 |             `,
24 |         }),
25 |     })
26 |     .then(async (res) => {
27 |         if (res.ok) {
28 |             return res.json();
29 |         } else {
30 |             throw await res.json();
31 |         }
32 |     })
33 |     .then(({ data: { records } }) => {
34 |         console.log({records: records})
35 |         return records.map((record: ZBQuery) => {       
36 |             console.log({record})     
37 |             return {
38 |                 id: record.id,
39 |                 addr: scValToNative(
40 |                     xdr.ScVal.fromXDR(record.topic_raw, "base64"),
41 |                 ),
42 |                 timestamp: new Date(record.ledger_closed_at), // 2024-12-17 22:19:36.000000 UTC
43 |                 txHash: record.transaction_hash,
44 |                 msg: record.value,
45 |             };
46 |         });
47 |     });
48 | }
49 | 


--------------------------------------------------------------------------------
/tsconfig.json:
--------------------------------------------------------------------------------
 1 | {
 2 |   "compilerOptions": {
 3 |     "target": "ES2017",
 4 |     "lib": ["dom", "dom.iterable", "esnext"],
 5 |     "allowJs": true,
 6 |     "skipLibCheck": true,
 7 |     "strict": true,
 8 |     "noEmit": true,
 9 |     "esModuleInterop": true,
10 |     "module": "esnext",
11 |     "moduleResolution": "bundler",
12 |     "resolveJsonModule": true,
13 |     "isolatedModules": true,
14 |     "jsx": "preserve",
15 |     "incremental": true,
16 |     "plugins": [
17 |       {
18 |         "name": "next"
19 |       }
20 |     ],
21 |     "paths": {
22 |       "@/*": ["./src/*"],
23 |     }
24 |   },
25 |   "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
26 |   "exclude": ["node_modules"]
27 | }
28 | 


--------------------------------------------------------------------------------